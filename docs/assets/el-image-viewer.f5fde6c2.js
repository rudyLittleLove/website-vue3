import{m as ce,a as V}from"./typescript.6eccdbdd.js";import{aI as he,h as ue,P as ae,d as fe,aJ as se,s as w,aK as ye,I as _e,j as h,M as ne,ai as de,U as pe,o as y,v as oe,b as c,w as I,a as m,y as u,e as t,X as be,z as _,c as S,F as re,x as ke,r as xe,ak as ze,al as Ie,A as le,t as U,au as Le,ay as Ee,aL as Ce,E as ve,ah as Oe,Q as Se,Y as Te,O as Ne}from"./index.289bf692.js";import{a as $,i as ie,u as me,E as O,_ as ge,d as $e,f as Ae}from"./index.0de585cb.js";import{j as Re,s as Me,g as Be,b as Ve,d as Ye,z as De,k as je,r as Fe,n as Xe}from"./index.93f89a9b.js";import{u as we}from"./index.a0207f98.js";import{d as Pe,u as He,g as Ze}from"./index.01972e81.js";import{E as B}from"./aria.6e9bc94f.js";import{u as We}from"./el-input.345a6e66.js";var Ke="Expected a function";function te(i,f,n){var r=!0,T=!0;if(typeof i!="function")throw new TypeError(Ke);return he(n)&&(r="leading"in n?!!n.leading:r,T="trailing"in n?!!n.trailing:T),Pe(i,f,{leading:r,maxWait:f,trailing:T})}const Ue=(i,f)=>{if(!$||!i||!f)return!1;const n=i.getBoundingClientRect();let r;return f instanceof Element?r=f.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<r.bottom&&n.bottom>r.top&&n.right>r.left&&n.left<r.right},qe=()=>$&&/firefox/i.test(window.navigator.userAgent),Ge=ue({urlList:{type:ae(Array),default:()=>ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),Je={close:()=>!0,switch:i=>ie(i)},Qe=["src"],et={name:"ElImageViewer"},tt=fe({...et,props:Ge,emits:Je,setup(i,{emit:f}){const n=i,r={CONTAIN:{name:"contain",icon:se(Re)},ORIGINAL:{name:"original",icon:se(Me)}},T=qe()?"DOMMouseScroll":"mousewheel",{t:L}=we(),l=me("image-viewer"),{nextZIndex:q}=He(),N=w(),b=w([]),k=ye(),x=w(!0),d=w(n.initialIndex),v=_e(r.CONTAIN),s=w({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),Y=h(()=>{const{urlList:a}=n;return a.length<=1}),A=h(()=>d.value===0),P=h(()=>d.value===n.urlList.length-1),G=h(()=>n.urlList[d.value]),D=h(()=>{const{scale:a,deg:e,offsetX:o,offsetY:p,enableTransition:E}=s.value;let g=o/a,C=p/a;switch(e%360){case 90:case-270:[g,C]=[C,-g];break;case 180:case-180:[g,C]=[-g,-C];break;case 270:case-90:[g,C]=[-C,g];break}const M={transform:`scale(${a}) rotate(${e}deg) translate(${g}px, ${C}px)`,transition:E?"transform .3s":""};return v.value.name===r.CONTAIN.name&&(M.maxWidth=M.maxHeight="100%"),M}),J=h(()=>ie(n.zIndex)?n.zIndex:q());function R(){Q(),f("close")}function j(){const a=te(o=>{switch(o.code){case B.esc:n.closeOnPressEscape&&R();break;case B.space:X();break;case B.left:W();break;case B.up:z("zoomIn");break;case B.right:K();break;case B.down:z("zoomOut");break}}),e=te(o=>{(o.wheelDelta?o.wheelDelta:-o.detail)>0?z("zoomIn",{zoomRate:1.2,enableTransition:!1}):z("zoomOut",{zoomRate:1.2,enableTransition:!1})});k.run(()=>{V(document,"keydown",a),V(document,T,e)})}function Q(){k.stop()}function ee(){x.value=!1}function H(a){x.value=!1,a.target.alt=L("el.image.error")}function Z(a){if(x.value||a.button!==0||!N.value)return;s.value.enableTransition=!1;const{offsetX:e,offsetY:o}=s.value,p=a.pageX,E=a.pageY,g=te(M=>{s.value={...s.value,offsetX:e+M.pageX-p,offsetY:o+M.pageY-E}}),C=V(document,"mousemove",g);V(document,"mouseup",()=>{C()}),a.preventDefault()}function F(){s.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function X(){if(x.value)return;const a=Ce(r),e=Object.values(r),o=v.value.name,E=(e.findIndex(g=>g.name===o)+1)%a.length;v.value=r[a[E]],F()}function W(){if(A.value&&!n.infinite)return;const a=n.urlList.length;d.value=(d.value-1+a)%a}function K(){if(P.value&&!n.infinite)return;const a=n.urlList.length;d.value=(d.value+1)%a}function z(a,e={}){if(x.value)return;const{zoomRate:o,rotateDeg:p,enableTransition:E}={zoomRate:1.4,rotateDeg:90,enableTransition:!0,...e};switch(a){case"zoomOut":s.value.scale>.2&&(s.value.scale=Number.parseFloat((s.value.scale/o).toFixed(3)));break;case"zoomIn":s.value.scale<7&&(s.value.scale=Number.parseFloat((s.value.scale*o).toFixed(3)));break;case"clockwise":s.value.deg+=p;break;case"anticlockwise":s.value.deg-=p;break}s.value.enableTransition=E}return ne(G,()=>{de(()=>{const a=b.value[0];a!=null&&a.complete||(x.value=!0)})}),ne(d,a=>{F(),f("switch",a)}),pe(()=>{var a,e;j(),(e=(a=N.value)==null?void 0:a.focus)==null||e.call(a)}),(a,e)=>(y(),oe(Ee,{to:"body",disabled:!a.teleported},[c(Le,{name:"viewer-fade",appear:""},{default:I(()=>[m("div",{ref_key:"wrapper",ref:N,tabindex:-1,class:u(t(l).e("wrapper")),style:le({zIndex:t(J)})},[m("div",{class:u(t(l).e("mask")),onClick:e[0]||(e[0]=be(o=>a.hideOnClickModal&&R(),["self"]))},null,2),_(" CLOSE "),m("span",{class:u([t(l).e("btn"),t(l).e("close")]),onClick:R},[c(t(O),null,{default:I(()=>[c(t(Be))]),_:1})],2),_(" ARROW "),t(Y)?_("v-if",!0):(y(),S(re,{key:0},[m("span",{class:u([t(l).e("btn"),t(l).e("prev"),t(l).is("disabled",!a.infinite&&t(A))]),onClick:W},[c(t(O),null,{default:I(()=>[c(t(Ve))]),_:1})],2),m("span",{class:u([t(l).e("btn"),t(l).e("next"),t(l).is("disabled",!a.infinite&&t(P))]),onClick:K},[c(t(O),null,{default:I(()=>[c(t(Ye))]),_:1})],2)],64)),_(" ACTIONS "),m("div",{class:u([t(l).e("btn"),t(l).e("actions")])},[m("div",{class:u(t(l).e("actions__inner"))},[c(t(O),{onClick:e[1]||(e[1]=o=>z("zoomOut"))},{default:I(()=>[c(t(De))]),_:1}),c(t(O),{onClick:e[2]||(e[2]=o=>z("zoomIn"))},{default:I(()=>[c(t(je))]),_:1}),m("i",{class:u(t(l).e("actions__divider"))},null,2),c(t(O),{onClick:X},{default:I(()=>[(y(),oe(ke(t(v).icon)))]),_:1}),m("i",{class:u(t(l).e("actions__divider"))},null,2),c(t(O),{onClick:e[3]||(e[3]=o=>z("anticlockwise"))},{default:I(()=>[c(t(Fe))]),_:1}),c(t(O),{onClick:e[4]||(e[4]=o=>z("clockwise"))},{default:I(()=>[c(t(Xe))]),_:1})],2)],2),_(" CANVAS "),m("div",{class:u(t(l).e("canvas"))},[(y(!0),S(re,null,xe(a.urlList,(o,p)=>ze((y(),S("img",{ref_for:!0,ref:E=>b.value[p]=E,key:o,src:o,style:le(t(D)),class:u(t(l).e("img")),onLoad:ee,onError:H,onMousedown:Z},null,46,Qe)),[[Ie,p===d.value]])),128))],2),U(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var at=ge(tt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const nt=ve(at),ot=ue({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:ae([String,Object])},previewSrcList:{type:ae(Array),default:()=>ce([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),rt={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ie(i),close:()=>!0},lt=["src","loading"],it={key:0},st={name:"ElImage",inheritAttrs:!1},ct=fe({...st,props:ot,emits:rt,setup(i,{emit:f}){const n=i;let r="";const{t:T}=we(),L=me("image"),l=Oe(),q=We(),N=w(),b=w(!1),k=w(!0),x=w(!1),d=w(),v=w(),s=$&&"loading"in HTMLImageElement.prototype;let Y,A;const P=h(()=>l.style),G=h(()=>{const{fit:e}=n;return $&&e?{objectFit:e}:{}}),D=h(()=>{const{previewSrcList:e}=n;return Array.isArray(e)&&e.length>0}),J=h(()=>{const{previewSrcList:e,initialIndex:o}=n;let p=o;return o>e.length-1&&(p=0),p}),R=h(()=>n.loading==="eager"?!1:!s&&n.loading==="lazy"||n.lazy),j=()=>{!$||(k.value=!0,b.value=!1,N.value=n.src)};function Q(e){k.value=!1,b.value=!1,f("load",e)}function ee(e){k.value=!1,b.value=!0,f("error",e)}function H(){Ue(d.value,v.value)&&(j(),X())}const Z=Ae(H,200);async function F(){var e;if(!$)return;await de();const{scrollContainer:o}=n;$e(o)?v.value=o:Ne(o)&&o!==""?v.value=(e=document.querySelector(o))!=null?e:void 0:d.value&&(v.value=Ze(d.value)),v.value&&(Y=V(v,"scroll",Z),setTimeout(()=>H(),100))}function X(){!$||!v.value||!Z||(Y==null||Y(),v.value=void 0)}function W(e){if(!!e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function K(){!D.value||(A=V("wheel",W,{passive:!1}),r=document.body.style.overflow,document.body.style.overflow="hidden",x.value=!0)}function z(){A==null||A(),document.body.style.overflow=r,x.value=!1,f("close")}function a(e){f("switch",e)}return ne(()=>n.src,()=>{R.value?(k.value=!0,b.value=!1,X(),F()):j()}),pe(()=>{R.value?F():j()}),(e,o)=>(y(),S("div",{ref_key:"container",ref:d,class:u([t(L).b(),e.$attrs.class]),style:le(t(P))},[N.value!==void 0&&!b.value?(y(),S("img",Se({key:0},t(q),{src:N.value,loading:e.loading,style:t(G),class:[t(L).e("inner"),t(D)&&t(L).e("preview"),k.value&&t(L).is("loading")],onClick:K,onLoad:Q,onError:ee}),null,16,lt)):_("v-if",!0),k.value||b.value?(y(),S("div",{key:1,class:u(t(L).e("wrapper"))},[k.value?U(e.$slots,"placeholder",{key:0},()=>[m("div",{class:u(t(L).e("placeholder"))},null,2)]):b.value?U(e.$slots,"error",{key:1},()=>[m("div",{class:u(t(L).e("error"))},Te(t(T)("el.image.error")),3)]):_("v-if",!0)],2)):_("v-if",!0),t(D)?(y(),S(re,{key:2},[x.value?(y(),oe(t(nt),{key:0,"z-index":e.zIndex,"initial-index":t(J),infinite:e.infinite,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:z,onSwitch:a},{default:I(()=>[e.$slots.viewer?(y(),S("div",it,[U(e.$slots,"viewer")])):_("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}});var ut=ge(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const yt=ve(ut);export{yt as E};
