import{h as ye,P as oe,i as ke,az as $e,s as re,U as Ue,ai as fe,j as L,I as je,m as Je,M as ue,d as Pe,C as He,ax as me,o as A,c as W,b as F,w as Y,a as P,Y as te,e as d,y as R,W as Ge,A as B,O as Ee,a1 as qe,q as Qe,B as Ze,v as he,z as ie,F as le,r as ce,E as et,g as Se,p as tt,f as it}from"./index.289bf692.js";import{E as Fe}from"./el-input-number.830f6c0d.js";import"./el-input.345a6e66.js";import"./el-tooltip.0ca4bad9.js";import{d as Ke,c as lt,E as rt,a as st}from"./el-select.f94e6760.js";import{E as nt,a as at}from"./el-form-item.11763ea7.js";import{E as ot}from"./el-button.0c3863f2.js";import{U as de,I as _e,C as Ve}from"./event.6c7ea317.js";import{i as xe,u as Le,_ as ze}from"./index.0de585cb.js";import{E as dt}from"./aria.6e9bc94f.js";import{d as Ae}from"./index.01972e81.js";import{u as ut}from"./index.a0207f98.js";import{u as ht,a as ct}from"./index.ea4d8fa0.js";import{a as ft,t as pt,d as Te}from"./typescript.6eccdbdd.js";import{_ as bt}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.93f89a9b.js";import"./icon.0d25849f.js";import"./index.96323e08.js";const Xe=Symbol("sliderContextKey"),gt=ye({modelValue:{type:oe([Number,Array]),default:0},id:{type:String,default:void 0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},showInput:Boolean,showInputControls:{type:Boolean,default:!0},size:ke,inputSize:ke,showStops:Boolean,showTooltip:{type:Boolean,default:!0},formatTooltip:{type:oe(Function),default:void 0},disabled:Boolean,range:Boolean,vertical:Boolean,height:String,debounce:{type:Number,default:300},label:{type:String,default:void 0},rangeStartLabel:{type:String,default:void 0},rangeEndLabel:{type:String,default:void 0},formatValueText:{type:oe(Function),default:void 0},tooltipClass:{type:String,default:void 0},placement:{type:String,values:Ke,default:"top"},marks:{type:oe(Object)},validateEvent:{type:Boolean,default:!0}}),ve=e=>xe(e)||$e(e)&&e.every(xe),vt={[de]:ve,[_e]:ve,[Ve]:ve},mt=(e,t,i)=>{const l=re();return Ue(async()=>{e.range?(Array.isArray(e.modelValue)?(t.firstValue=Math.max(e.min,e.modelValue[0]),t.secondValue=Math.min(e.max,e.modelValue[1])):(t.firstValue=e.min,t.secondValue=e.max),t.oldValue=[t.firstValue,t.secondValue]):(typeof e.modelValue!="number"||Number.isNaN(e.modelValue)?t.firstValue=e.min:t.firstValue=Math.min(e.max,Math.max(e.min,e.modelValue)),t.oldValue=t.firstValue),ft(window,"resize",i),await fe(),i()}),{sliderWrapper:l}},xt=e=>L(()=>e.marks?Object.keys(e.marks).map(parseFloat).sort((i,l)=>i-l).filter(i=>i<=e.max&&i>=e.min).map(i=>({point:i,position:(i-e.min)*100/(e.max-e.min),mark:e.marks[i]})):[]),wt=(e,t,i)=>{const{form:l,formItem:r}=ht(),s=je(),n=re(),u=re(),o={firstButton:n,secondButton:u},h=L(()=>e.disabled||(l==null?void 0:l.disabled)||!1),c=L(()=>Math.min(t.firstValue,t.secondValue)),a=L(()=>Math.max(t.firstValue,t.secondValue)),p=L(()=>e.range?`${100*(a.value-c.value)/(e.max-e.min)}%`:`${100*(t.firstValue-e.min)/(e.max-e.min)}%`),g=L(()=>e.range?`${100*(c.value-e.min)/(e.max-e.min)}%`:"0%"),S=L(()=>e.vertical?{height:e.height}:{}),b=L(()=>e.vertical?{height:p.value,bottom:g.value}:{width:p.value,left:g.value}),f=()=>{s.value&&(t.sliderSize=s.value[`client${e.vertical?"Height":"Width"}`])},y=w=>{const E=e.min+w*(e.max-e.min)/100;if(!e.range)return n;let T;return Math.abs(c.value-E)<Math.abs(a.value-E)?T=t.firstValue<t.secondValue?"firstButton":"secondButton":T=t.firstValue>t.secondValue?"firstButton":"secondButton",o[T]},k=w=>{const E=y(w);return E.value.setPosition(w),E},K=w=>{t.firstValue=w,_(e.range?[c.value,a.value]:w)},x=w=>{t.secondValue=w,e.range&&_([c.value,a.value])},_=w=>{i(de,w),i(_e,w)},J=async()=>{await fe(),i(Ve,e.range?[c.value,a.value]:e.modelValue)},G=w=>{var E,T,Q,Z,ee,U;if(h.value||t.dragging)return;f();let I=0;if(e.vertical){const H=(Q=(T=(E=w.touches)==null?void 0:E.item(0))==null?void 0:T.clientY)!=null?Q:w.clientY;I=(s.value.getBoundingClientRect().bottom-H)/t.sliderSize*100}else{const H=(U=(ee=(Z=w.touches)==null?void 0:Z.item(0))==null?void 0:ee.clientX)!=null?U:w.clientX,V=s.value.getBoundingClientRect().left;I=(H-V)/t.sliderSize*100}if(!(I<0||I>100))return k(I)};return{elFormItem:r,slider:s,firstButton:n,secondButton:u,sliderDisabled:h,minValue:c,maxValue:a,runwayStyle:S,barStyle:b,resetSize:f,setPosition:k,emitChange:J,onSliderWrapperPrevent:w=>{var E,T;(((E=o.firstButton.value)==null?void 0:E.dragging)||((T=o.secondButton.value)==null?void 0:T.dragging))&&w.preventDefault()},onSliderClick:w=>{G(w)&&J()},onSliderDown:async w=>{const E=G(w);E&&(await fe(),E.value.onButtonDown(w))},setFirstValue:K,setSecondValue:x}},{left:yt,down:Pt,right:St,up:_t,home:Lt,end:Nt,pageUp:kt,pageDown:Et}=dt,At=(e,t,i)=>{const l=re(),r=re(!1),s=L(()=>t.value instanceof Function),n=L(()=>s.value&&t.value(e.modelValue)||e.modelValue),u=Ae(()=>{i.value&&(r.value=!0)},50),o=Ae(()=>{i.value&&(r.value=!1)},50);return{tooltip:l,tooltipVisible:r,formatValue:n,displayTooltip:u,hideTooltip:o}},Tt=(e,t,i)=>{const{disabled:l,min:r,max:s,step:n,showTooltip:u,precision:o,sliderSize:h,formatTooltip:c,emitChange:a,resetSize:p,updateDragging:g}=Je(Xe),{tooltip:S,tooltipVisible:b,formatValue:f,displayTooltip:y,hideTooltip:k}=At(e,c,u),K=re(),x=L(()=>`${(e.modelValue-r.value)/(s.value-r.value)*100}%`),_=L(()=>e.vertical?{bottom:x.value}:{left:x.value}),J=()=>{t.hovering=!0,y()},G=()=>{t.hovering=!1,t.dragging||k()},q=v=>{l.value||(v.preventDefault(),I(v),window.addEventListener("mousemove",H),window.addEventListener("touchmove",H),window.addEventListener("mouseup",V),window.addEventListener("touchend",V),window.addEventListener("contextmenu",V),K.value.focus())},O=v=>{l.value||(t.newPosition=Number.parseFloat(x.value)+v/(s.value-r.value)*100,D(t.newPosition),a())},$=()=>{O(-n.value)},w=()=>{O(n.value)},E=()=>{O(-n.value*4)},T=()=>{O(n.value*4)},Q=()=>{l.value||(D(0),a())},Z=()=>{l.value||(D(100),a())},ee=v=>{let N=!0;[yt,Pt].includes(v.key)?$():[St,_t].includes(v.key)?w():v.key===Lt?Q():v.key===Nt?Z():v.key===Et?E():v.key===kt?T():N=!1,N&&v.preventDefault()},U=v=>{let N,z;return v.type.startsWith("touch")?(z=v.touches[0].clientY,N=v.touches[0].clientX):(z=v.clientY,N=v.clientX),{clientX:N,clientY:z}},I=v=>{t.dragging=!0,t.isClick=!0;const{clientX:N,clientY:z}=U(v);e.vertical?t.startY=z:t.startX=N,t.startPosition=Number.parseFloat(x.value),t.newPosition=t.startPosition},H=v=>{if(t.dragging){t.isClick=!1,y(),p();let N;const{clientX:z,clientY:j}=U(v);e.vertical?(t.currentY=j,N=(t.startY-t.currentY)/h.value*100):(t.currentX=z,N=(t.currentX-t.startX)/h.value*100),t.newPosition=t.startPosition+N,D(t.newPosition)}},V=()=>{t.dragging&&(setTimeout(()=>{t.dragging=!1,t.hovering||k(),t.isClick||(D(t.newPosition),a())},0),window.removeEventListener("mousemove",H),window.removeEventListener("touchmove",H),window.removeEventListener("mouseup",V),window.removeEventListener("touchend",V),window.removeEventListener("contextmenu",V))},D=async v=>{if(v===null||Number.isNaN(+v))return;v<0?v=0:v>100&&(v=100);const N=100/((s.value-r.value)/n.value);let j=Math.round(v/N)*N*(s.value-r.value)*.01+r.value;j=Number.parseFloat(j.toFixed(o.value)),i(de,j),!t.dragging&&e.modelValue!==t.oldValue&&(t.oldValue=e.modelValue),await fe(),t.dragging&&y(),S.value.updatePopper()};return ue(()=>t.dragging,v=>{g(v)}),{button:K,tooltip:S,tooltipVisible:b,showTooltip:u,wrapperStyle:_,formatValue:f,handleMouseEnter:J,handleMouseLeave:G,onButtonDown:q,onKeyDown:ee,setPosition:D}},Ct=(e,t,i,l)=>({stops:L(()=>{if(!e.showStops||e.min>e.max)return[];if(e.step===0)return[];const n=(e.max-e.min)/e.step,u=100*e.step/(e.max-e.min),o=Array.from({length:n-1}).map((h,c)=>(c+1)*u);return e.range?o.filter(h=>h<100*(i.value-e.min)/(e.max-e.min)||h>100*(l.value-e.min)/(e.max-e.min)):o.filter(h=>h>100*(t.firstValue-e.min)/(e.max-e.min))}),getStopStyle:n=>e.vertical?{bottom:`${n}%`}:{left:`${n}%`}}),Mt=(e,t,i,l,r,s)=>{const n=h=>{r(de,h),r(_e,h)},u=()=>e.range?![i.value,l.value].every((h,c)=>h===t.oldValue[c]):e.modelValue!==t.oldValue,o=()=>{var h,c;if(e.min>e.max){pt("Slider","min should not be greater than max.");return}const a=e.modelValue;e.range&&Array.isArray(a)?a[1]<e.min?n([e.min,e.min]):a[0]>e.max?n([e.max,e.max]):a[0]<e.min?n([e.min,a[1]]):a[1]>e.max?n([a[0],e.max]):(t.firstValue=a[0],t.secondValue=a[1],u()&&(e.validateEvent&&((h=s==null?void 0:s.validate)==null||h.call(s,"change").catch(p=>Te())),t.oldValue=a.slice())):!e.range&&typeof a=="number"&&!Number.isNaN(a)&&(a<e.min?n(e.min):a>e.max?n(e.max):(t.firstValue=a,u()&&(e.validateEvent&&((c=s==null?void 0:s.validate)==null||c.call(s,"change").catch(p=>Te())),t.oldValue=a)))};o(),ue(()=>t.dragging,h=>{h||o()}),ue(()=>e.modelValue,(h,c)=>{t.dragging||Array.isArray(h)&&Array.isArray(c)&&h.every((a,p)=>a===c[p])&&t.firstValue===h[0]&&t.secondValue===h[1]||o()},{deep:!0}),ue(()=>[e.min,e.max],()=>{o()})},Wt=ye({modelValue:{type:Number,default:0},vertical:Boolean,tooltipClass:String,placement:{type:String,values:Ke,default:"top"}}),Ht={[de]:e=>xe(e)},Ft={name:"ElSliderButton"},Kt=Pe({...Ft,props:Wt,emits:Ht,setup(e,{expose:t,emit:i}){const l=e,r=Le("slider"),s=He({hovering:!1,dragging:!1,isClick:!1,startX:0,currentX:0,startY:0,currentY:0,startPosition:0,newPosition:0,oldValue:l.modelValue}),{button:n,tooltip:u,showTooltip:o,tooltipVisible:h,wrapperStyle:c,formatValue:a,handleMouseEnter:p,handleMouseLeave:g,onButtonDown:S,onKeyDown:b,setPosition:f}=Tt(l,s,i),{hovering:y,dragging:k}=me(s);return t({onButtonDown:S,onKeyDown:b,setPosition:f,hovering:y,dragging:k}),(K,x)=>(A(),W("div",{ref_key:"button",ref:n,class:R([d(r).e("button-wrapper"),{hover:d(y),dragging:d(k)}]),style:B(d(c)),tabindex:"0",onMouseenter:x[1]||(x[1]=(..._)=>d(p)&&d(p)(..._)),onMouseleave:x[2]||(x[2]=(..._)=>d(g)&&d(g)(..._)),onMousedown:x[3]||(x[3]=(..._)=>d(S)&&d(S)(..._)),onTouchstart:x[4]||(x[4]=(..._)=>d(S)&&d(S)(..._)),onFocus:x[5]||(x[5]=(..._)=>d(p)&&d(p)(..._)),onBlur:x[6]||(x[6]=(..._)=>d(g)&&d(g)(..._)),onKeydown:x[7]||(x[7]=(..._)=>d(b)&&d(b)(..._))},[F(d(lt),{ref_key:"tooltip",ref:u,visible:d(h),"onUpdate:visible":x[0]||(x[0]=_=>Ge(h)?h.value=_:null),placement:K.placement,"fallback-placements":["top","bottom","right","left"],"stop-popper-mouse-event":!1,"popper-class":K.tooltipClass,disabled:!d(o),persistent:""},{content:Y(()=>[P("span",null,te(d(a)),1)]),default:Y(()=>[P("div",{class:R([d(r).e("button"),{hover:d(y),dragging:d(k)}])},null,2)]),_:1},8,["visible","placement","popper-class","disabled"])],38))}});var Ce=ze(Kt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/slider/src/button.vue"]]);const Vt=ye({mark:{type:oe([String,Object]),default:void 0}});var zt=Pe({name:"ElSliderMarker",props:Vt,setup(e){const t=Le("slider"),i=L(()=>Ee(e.mark)?e.mark:e.mark.label),l=L(()=>Ee(e.mark)?void 0:e.mark.style);return()=>qe("div",{class:t.e("marks-text"),style:l},i.value)}});const Xt=["id","role","aria-label","aria-labelledby"],Rt={key:1},Bt={name:"ElSlider"},It=Pe({...Bt,props:gt,emits:vt,setup(e,{expose:t,emit:i}){const l=e,r=Le("slider"),{t:s}=ut(),n=He({firstValue:0,secondValue:0,oldValue:0,dragging:!1,sliderSize:1}),{elFormItem:u,slider:o,firstButton:h,secondButton:c,sliderDisabled:a,minValue:p,maxValue:g,runwayStyle:S,barStyle:b,resetSize:f,emitChange:y,onSliderWrapperPrevent:k,onSliderClick:K,onSliderDown:x,setFirstValue:_,setSecondValue:J}=wt(l,n,i),{stops:G,getStopStyle:q}=Ct(l,n,p,g),{inputId:O,isLabeledByFormItem:$}=ct(l,{formItemContext:u}),w=Qe(),E=L(()=>l.inputSize||w.value),T=L(()=>l.label||s("el.slider.defaultLabel",{min:l.min,max:l.max})),Q=L(()=>l.range?l.rangeStartLabel||s("el.slider.defaultRangeStartLabel"):T.value),Z=L(()=>l.formatValueText?l.formatValueText(v.value):`${v.value}`),ee=L(()=>l.rangeEndLabel||s("el.slider.defaultRangeEndLabel")),U=L(()=>l.formatValueText?l.formatValueText(N.value):`${N.value}`),I=L(()=>[r.b(),r.m(w.value),r.is("vertical",l.vertical),{[r.m("with-input")]:l.showInput}]),H=xt(l);Mt(l,n,p,g,i,u);const V=L(()=>{const m=[l.min,l.max,l.step].map(X=>{const ne=`${X}`.split(".")[1];return ne?ne.length:0});return Math.max.apply(null,m)}),{sliderWrapper:D}=mt(l,n,f),{firstValue:v,secondValue:N,sliderSize:z}=me(n),j=m=>{n.dragging=m};return Ze(Xe,{...me(l),sliderSize:z,disabled:a,precision:V,emitChange:y,resetSize:f,updateDragging:j}),t({onSliderClick:K}),(m,X)=>{var ne,Ne;return A(),W("div",{id:m.range?d(O):void 0,ref_key:"sliderWrapper",ref:D,class:R(d(I)),role:m.range?"group":void 0,"aria-label":m.range&&!d($)?d(T):void 0,"aria-labelledby":m.range&&d($)?(ne=d(u))==null?void 0:ne.labelId:void 0,onTouchstart:X[2]||(X[2]=(...C)=>d(k)&&d(k)(...C)),onTouchmove:X[3]||(X[3]=(...C)=>d(k)&&d(k)(...C))},[P("div",{ref_key:"slider",ref:o,class:R([d(r).e("runway"),{"show-input":m.showInput&&!m.range},d(r).is("disabled",d(a))]),style:B(d(S)),onMousedown:X[0]||(X[0]=(...C)=>d(x)&&d(x)(...C)),onTouchstart:X[1]||(X[1]=(...C)=>d(x)&&d(x)(...C))},[P("div",{class:R(d(r).e("bar")),style:B(d(b))},null,6),F(Ce,{id:m.range?void 0:d(O),ref_key:"firstButton",ref:h,"model-value":d(v),vertical:m.vertical,"tooltip-class":m.tooltipClass,placement:m.placement,role:"slider","aria-label":m.range||!d($)?d(Q):void 0,"aria-labelledby":!m.range&&d($)?(Ne=d(u))==null?void 0:Ne.labelId:void 0,"aria-valuemin":m.min,"aria-valuemax":m.range?d(N):m.max,"aria-valuenow":d(v),"aria-valuetext":d(Z),"aria-orientation":m.vertical?"vertical":"horizontal","aria-disabled":d(a),"onUpdate:modelValue":d(_)},null,8,["id","model-value","vertical","tooltip-class","placement","aria-label","aria-labelledby","aria-valuemin","aria-valuemax","aria-valuenow","aria-valuetext","aria-orientation","aria-disabled","onUpdate:modelValue"]),m.range?(A(),he(Ce,{key:0,ref_key:"secondButton",ref:c,"model-value":d(N),vertical:m.vertical,"tooltip-class":m.tooltipClass,placement:m.placement,role:"slider","aria-label":d(ee),"aria-valuemin":d(v),"aria-valuemax":m.max,"aria-valuenow":d(N),"aria-valuetext":d(U),"aria-orientation":m.vertical?"vertical":"horizontal","aria-disabled":d(a),"onUpdate:modelValue":d(J)},null,8,["model-value","vertical","tooltip-class","placement","aria-label","aria-valuemin","aria-valuemax","aria-valuenow","aria-valuetext","aria-orientation","aria-disabled","onUpdate:modelValue"])):ie("v-if",!0),m.showStops?(A(),W("div",Rt,[(A(!0),W(le,null,ce(d(G),(C,ae)=>(A(),W("div",{key:ae,class:R(d(r).e("stop")),style:B(d(q)(C))},null,6))),128))])):ie("v-if",!0),d(H).length>0?(A(),W(le,{key:2},[P("div",null,[(A(!0),W(le,null,ce(d(H),(C,ae)=>(A(),W("div",{key:ae,style:B(d(q)(C.position)),class:R([d(r).e("stop"),d(r).e("marks-stop")])},null,6))),128))]),P("div",{class:R(d(r).e("marks"))},[(A(!0),W(le,null,ce(d(H),(C,ae)=>(A(),he(d(zt),{key:ae,mark:C.mark,style:B(d(q)(C.position))},null,8,["mark","style"]))),128))],2)],64)):ie("v-if",!0)],38),m.showInput&&!m.range?(A(),he(d(Fe),{key:0,ref:"input","model-value":d(v),class:R(d(r).e("input")),step:m.step,disabled:d(a),controls:m.showInputControls,min:m.min,max:m.max,debounce:m.debounce,size:d(E),"onUpdate:modelValue":d(_),onChange:d(y)},null,8,["model-value","class","step","disabled","controls","min","max","debounce","size","onUpdate:modelValue","onChange"])):ie("v-if",!0)],42,Xt)}}});var Yt=ze(It,[["__file","/home/runner/work/element-plus/element-plus/packages/components/slider/src/slider.vue"]]);const Ot=et(Yt);var Re=function(){if(typeof Map!="undefined")return Map;function e(t,i){var l=-1;return t.some(function(r,s){return r[0]===i?(l=s,!0):!1}),l}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(i){var l=e(this.__entries__,i),r=this.__entries__[l];return r&&r[1]},t.prototype.set=function(i,l){var r=e(this.__entries__,i);~r?this.__entries__[r][1]=l:this.__entries__.push([i,l])},t.prototype.delete=function(i){var l=this.__entries__,r=e(l,i);~r&&l.splice(r,1)},t.prototype.has=function(i){return!!~e(this.__entries__,i)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(i,l){l===void 0&&(l=null);for(var r=0,s=this.__entries__;r<s.length;r++){var n=s[r];i.call(l,n[1],n[0])}},t}()}(),we=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,pe=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),Dt=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(pe):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),$t=2;function Ut(e,t){var i=!1,l=!1,r=0;function s(){i&&(i=!1,e()),l&&u()}function n(){Dt(s)}function u(){var o=Date.now();if(i){if(o-r<$t)return;l=!0}else i=!0,l=!1,setTimeout(n,t);r=o}return u}var jt=20,Jt=["top","right","bottom","left","width","height","size","weight"],Gt=typeof MutationObserver!="undefined",qt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Ut(this.refresh.bind(this),jt)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var i=this.observers_,l=i.indexOf(t);~l&&i.splice(l,1),!i.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return t.forEach(function(i){return i.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!we||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Gt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!we||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var i=t.propertyName,l=i===void 0?"":i,r=Jt.some(function(s){return!!~l.indexOf(s)});r&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),Be=function(e,t){for(var i=0,l=Object.keys(t);i<l.length;i++){var r=l[i];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},se=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||pe},Ie=ge(0,0,0,0);function be(e){return parseFloat(e)||0}function Me(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce(function(l,r){var s=e["border-"+r+"-width"];return l+be(s)},0)}function Qt(e){for(var t=["top","right","bottom","left"],i={},l=0,r=t;l<r.length;l++){var s=r[l],n=e["padding-"+s];i[s]=be(n)}return i}function Zt(e){var t=e.getBBox();return ge(0,0,t.width,t.height)}function ei(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return Ie;var l=se(e).getComputedStyle(e),r=Qt(l),s=r.left+r.right,n=r.top+r.bottom,u=be(l.width),o=be(l.height);if(l.boxSizing==="border-box"&&(Math.round(u+s)!==t&&(u-=Me(l,"left","right")+s),Math.round(o+n)!==i&&(o-=Me(l,"top","bottom")+n)),!ii(e)){var h=Math.round(u+s)-t,c=Math.round(o+n)-i;Math.abs(h)!==1&&(u-=h),Math.abs(c)!==1&&(o-=c)}return ge(r.left,r.top,u,o)}var ti=function(){return typeof SVGGraphicsElement!="undefined"?function(e){return e instanceof se(e).SVGGraphicsElement}:function(e){return e instanceof se(e).SVGElement&&typeof e.getBBox=="function"}}();function ii(e){return e===se(e).document.documentElement}function li(e){return we?ti(e)?Zt(e):ei(e):Ie}function ri(e){var t=e.x,i=e.y,l=e.width,r=e.height,s=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,n=Object.create(s.prototype);return Be(n,{x:t,y:i,width:l,height:r,top:i,right:t+l,bottom:r+i,left:t}),n}function ge(e,t,i,l){return{x:e,y:t,width:i,height:l}}var si=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ge(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=li(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),ni=function(){function e(t,i){var l=ri(i);Be(this,{target:t,contentRect:l})}return e}(),ai=function(){function e(t,i,l){if(this.activeObservations_=[],this.observations_=new Re,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=l}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(t instanceof se(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)||(i.set(t,new si(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(t instanceof se(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;!i.has(t)||(i.delete(t),i.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&t.activeObservations_.push(i)})},e.prototype.broadcastActive=function(){if(!!this.hasActive()){var t=this.callbackCtx_,i=this.activeObservations_.map(function(l){return new ni(l.target,l.broadcastRect())});this.callback_.call(t,i,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),Ye=typeof WeakMap!="undefined"?new WeakMap:new Re,Oe=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=qt.getInstance(),l=new ai(t,i,this);Ye.set(this,l)}return e}();["observe","unobserve","disconnect"].forEach(function(e){Oe.prototype[e]=function(){var t;return(t=Ye.get(this))[e].apply(t,arguments)}});var oi=function(){return typeof pe.ResizeObserver!="undefined"?pe.ResizeObserver:Oe}();const di=typeof window=="undefined",ui=function(e){for(let t of e){const i=t.target.__resizeListeners__||[];i.length&&i.forEach(l=>{l()})}},hi=function(e,t){di||(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new oi(ui),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},ci=function(e,t){!e||!e.__resizeListeners__||(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())},We=e=>e*(2-e);var fi={data(){return{canvasWrap:null,tableMenu:null,tableRule:null,chart:null,ctx:null,ctxRule:null,ctxFixed:null,ctxMenu:null,position:{},wrapWidth:0,wrapHeight:0,canvasHeight:0,translateX:0,translateY:0,rowHeight:40,rowHegihtOptions:[40,45,50,55,60,65],colw:40,colWidth:200,lineWidth:1,fontSize:16,fontFamily:"Microsoft YaHei Regular",tableBgColor:"transparent",tableHoverBgColor:"rgba(45, 140, 240, .1)",tableLevel3BgColor:"rgba(0, 0, 0, .04)",innerWrapBgColor:"#EEF6FD",lineColor:"#DBE2E8",fillStyle:"transparent",tickTextColor:"#84A6C3",pileStrColor:"#58718A",inOutIconBgColor:"#90A5BA",inOutIconColor:"#ffffff",fontColor:"#000000",tickFontSize:14,tickLength:8,offset:.5,scrollStep:20,ruleStep:400,preMeterToPx:4,meterToPx:4,stepPx:.5,meterToPxMin:1,meterToPxMax:30,ruleStepVal:100,faceWidth:8,zeroWidth:8,romeNumber:["\u2160","\u2161","\u2162","\u2163","\u2164","\u2165","\u2166","\u2167","\u2168","\u2169"],levelColor:["#4ECB73","#2DB7F5","#FAD337","#FF9900","#F86F00","#ED3F14"],rectColor:["#C5C9D0","#FF582F","#FF8F34","#FDC500","#3D87FF","#29CC95"],rectHoverColor:["#cccccc","#FC7858","#FAAE70","#F7D965","#84B3FE","#64D9B4"],minStripe:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGAgMAAACdogfbAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJUExURf///////////45K5f4AAAADdFJOUwQ/Ta3MexMAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAaSURBVAjXY2BzYJBkYEhhYJggwOCQwMA4AQASZAKV6dxVvQAAAABJRU5ErkJggg==",maxStripe:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAhAQMAAACC6DsSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAGUExURf///0dwTHBCPHYAAAACdFJOUx4AotLy5wAAAAlwSFlzAAAASAAAAEgARslrPgAAAFpJREFUCNeNzLENwCAUA9H7SkHJCBklo8FojMIIlCkQjokyQCTrqiejm4QGGXVO1LhQpSC8RYjJIczE2DETbady7cj0TWhi6yTfkn1r1jFrUHz7sfWHYRaYxQM150HTObrW+AAAAABJRU5ErkJggg==",minStripeColor:null,maxStripeColor:null,scale:1,targetX:0,targetY:0,animationStepX:0,animationStepY:0,stepTime:0,data:[],rootData:[{type:"stair",level:1,text:"\u96A7\u9053\u5168\u7A0B\u6869\u53F7",fixed:"xy",sort:-1},{type:"stair",level:1,text:"\u8BBE\u8BA1\u56F4\u5CA9\u7EA7\u522B",fixed:"y",data:[{start:0,end:100,level:0}]}],fixedData:'[{"type":"multistage","level":1,"text":"\u65BD\u5DE5\u8FDB\u5EA6","expand":true,"subList":[{"text":"\u5F00\u6316","tip":"100%","level":2,"color":"#2D8CF0","stripe":"thick","data":[{"start":0,"end":100,"level":0},{"start":100,"end":200,"level":3},{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":5}]},{"text":"\u4E8C\u6B21\u886C\u780C","tip":"5%","stripe":"thick","level":2}]},{"type":"multistage","level":1,"text":"\u8D28\u91CF\u68C0\u67E5","expand":false,"subList":[{"text":"\u521D\u671F\u652F\u62A4","tip":"10%","level":2,"stripe":"thin","data":[{"start":0,"end":100,"level":0},{"start":100,"end":200,"level":3},{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":5}]},{"text":"\u4E8C\u6B21\u886C\u780C","tip":"5%","stripe":"thin","level":2}]},{"type":"multistage","level":1,"text":"\u5DE5\u5E8F\u5F71\u50CF","expand":true,"subList":[{"level":2,"text":"\u660E\u6D1E\u886C\u780C","info":"\u660E\u6D1E\u53CA\u6D1E\u95E8","data":[{"start":50,"end":54,"level":0},{"start":100,"end":200,"level":3},{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":1},{"start":980,"end":1100,"level":5},{"start":1480,"end":1550,"level":5},{"start":2480,"end":2500,"level":3}],"expand":true,"subList":[{"text":"\u57FA\u7840","level":3},{"text":"\u94A2\u7B4B","level":3}]},{"level":2,"text":"\u660E\u6D1E\u53CA\u6D1E\u95E8","info":"\u660E\u6D1E\u53CA\u6D1E\u95E8","expand":false,"data":[{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":1},{"start":980,"end":1100,"level":5},{"start":1480,"end":1550,"level":5},{"start":2480,"end":2500,"level":3}],"subList":[{"text":"\u57FA\u7840","level":3,"data":[{"start":380,"end":600,"level":3},{"start":5400,"end":5500,"level":4}]},{"text":"\u94A2\u7B4B","level":3}]}]}]',extData:'[{"type":"multistage","level":1,"text":"\u65BD\u5DE5\u8FDB\u5EA6","expand":true,"subList":[{"text":"\u5F00\u6316","tip":"100%","level":2,"color":"#2D8CF0","stripe":"thick","data":[{"start":0,"end":100,"level":0},{"start":100,"end":200,"level":3},{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":5}]},{"text":"\u4E8C\u6B21\u886C\u780C","tip":"5%","stripe":"thick","level":2}]},{"type":"multistage","level":1,"text":"\u8D28\u91CF\u68C0\u67E5","expand":false,"subList":[{"text":"\u521D\u671F\u652F\u62A4","tip":"10%","level":2,"stripe":"thin","data":[{"start":0,"end":100,"level":0},{"start":100,"end":200,"level":3},{"start":200,"end":350,"level":2},{"start":370,"end":480,"level":4},{"start":480,"end":810,"level":5}]},{"text":"\u4E8C\u6B21\u886C\u780C","tip":"5%","stripe":"thin","level":2}]}]',rules:{},tableLine:{},shaft:{},startPileNo:150,endPileNo:700,startPileStr:"",endPileStr:"",current:null,rowIndex:-1,tunnelWidth:0,tableWidth:0,tableHeight:0,contentStartX:0,contentEndX:0,contentPosition:[0,0,0,0],oldDownX:0,oldDownY:0,mouseDownX:0,mouseDownY:0,lineTableData:[]}},computed:{ruleHeight(){return this.rowHeight*.48},tipHeight(){return this.rowHeight*.52},lineRectData(){return this.lineTableData.filter(e=>e.data||!e.expand&&e.fixed!=="xy")}},mounted(){hi(this.$refs.canvasWrap,this.listenVessel)},methods:{init(){this.canvasWrap=this.$refs.canvasWrap,this.canvasWrap.style.backgroundColor="#ffffff",this.canvasWrap.className=`${this.canvasWrap.className} canvas-container`,this.tableFixed=document.createElement("canvas"),this.tableMenu=document.createElement("canvas"),this.tableRule=document.createElement("canvas"),this.chart=document.createElement("canvas"),this.canvasWrap.appendChild(this.chart),this.canvasWrap.appendChild(this.tableRule),this.canvasWrap.appendChild(this.tableMenu),this.canvasWrap.appendChild(this.tableFixed),this.ctx=this.ctx||this.chart.getContext("2d"),this.ctxMenu=this.ctxMenu||this.tableMenu.getContext("2d"),this.ctxFixed=this.ctxFixed||this.tableFixed.getContext("2d"),this.ctxRule=this.ctxRule||this.tableRule.getContext("2d");let e=new Image;e.src=this.minStripe,e.onload=()=>{this.minStripeColor=this.ctx.createPattern(e,"repeat")};let t=new Image;t.src=this.maxStripe,t.onload=()=>{this.maxStripeColor=this.ctx.createPattern(t,"repeat")},this.listenVessel(),this.$nextTick(()=>{this.initEvent()})},initEvent(){this.position=this.canvasWrap.getBoundingClientRect(),this.canvasWrap.addEventListener("mousemove",this.addMouseMove),this.canvasWrap.addEventListener("mouseleave",this.addMouseLeave),this.canvasWrap.addEventListener("click",this.addMouseClick),this.canvasWrap.addEventListener("mousedown",this.addMouseDown),document.addEventListener("mouseup",this.addMouseUp),this.canvasWrap.addEventListener("mouseenter",this.addMouseWhell)},listenVessel(){clearTimeout(this.timer),this.canvasWrap&&(this.timer=setTimeout(()=>{this.tableRule.width=this.tableFixed.width=this.chart.width=this.tableMenu.width=this.wrapWidth=this.canvasWrap.clientWidth,this.tableRule.height=this.tableFixed.height=this.chart.height=this.tableMenu.height=this.wrapHeight=this.canvasWrap.clientHeight,this.renderAll()},50))},addMouseMove(e){this.targetX=e.offsetX,this.targetY=e.offsetY;let t=this.targetX*this.scale,i=this.targetY*this.scale,l=t-this.translateX*this.scale,r=i-this.translateY*this.scale,s=!1;switch(!0){case(this.targetY<this.ruleHeight&&this.targetX>this.colWidth):s=!0;var n=this.ruleStepVal/this.ruleStep,u=(this.targetX-this.colWidth)*n-this.translateX*n+this.startPileNo;this.current={tooltip:`K${Math.floor(u/1e3)}+${Math.round(u%1e3)}`,placement:"rule",tooltipXY:[this.targetX,0]};break;case this.targetY<this.rowHeight:break;case(this.targetX<this.colWidth&&this.targetY>this.rowHeight*2):this.lineTableData.forEach(a=>{!a.fixed&&this.isInnerPolygon([t,r],a.crd)&&(s=!0,this.current=a)});break;case(this.targetY<this.rowHeight*2&&this.targetX>this.colWidth):var o=this.lineRectData[0];o&&o.rect.forEach(a=>{this.isInnerPolygon([l,i],a.crd)&&(s=!0,a.placement="top",a.tooltipXY=[this.targetX,a.crd[1][1]],this.current=a)});break;case(this.targetY>this.rowHeight*2&&this.targetX>this.colWidth):var h=Math.floor(r/this.rowHeight)-1,c=this.lineRectData[h];c&&c.rect.forEach(a=>{this.isInnerPolygon([l,r],a.crd)&&(s=!0,a.placement="top",a.tooltipXY=[this.targetX,a.crd[1][1]+this.translateY],this.current=a)})}s||(this.current=null)},addMouseLeave(){this.current=null,this.removeMouseWhell()},addMouseClick(e){if(!(Math.abs(this.mouseDownX-e.offsetX)>2||Math.abs(this.mouseDownY-e.offsetY)>2))switch(!0){case(this.current&&this.current.expand!==void 0):this.current.expand=!this.current.expand,this.calcLineTableData(),this.renderAll();break;case(this.current&&!!this.current.id&&this.current.category==="processIma"):this.modalInfo={modal:!0,title:"\u8BE6\u60C5",id:this.current.id,readonly:!0}}},addMouseWhell(){this.canvasWrap.addEventListener("mousewheel",this.scrollFunc,{passive:!1})},removeMouseWhell(){this.canvasWrap.removeEventListener("mousewheel",this.scrollFunc,{passive:!1})},scrollFunc(e){if(e.preventDefault(),e.wheelDelta){let t=e.wheelDelta>0?-1:1,i=this.tableHeight>this.wrapHeight||this.tableWidth>this.wrapWidth;if(e.shiftKey&&this.tableWidth>this.wrapWidth)this.$refs.scrollX.scrollLeft=this.$refs.scrollX.scrollLeft+this.scrollStep*t*(e.altKey?8:1);else if(e.ctrlKey){this.meterToPx-=t*this.stepPx*(e.altKey?4:1),this.meterToPx=this.meterToPx<this.meterToPxMin?this.meterToPxMin:this.meterToPx,this.meterToPx=this.meterToPx>this.meterToPxMax?this.meterToPxMax:this.meterToPx;let l=this.ruleStepVal/this.ruleStep,r=(e.offsetX-this.colWidth)*l-this.translateX*l;this.ruleStep=this.meterToPx*this.ruleStepVal,this.meterToPx<this.meterToPxMax&&(this.current=null,this.$refs.scrollX.scrollLeft=this.$refs.scrollX.scrollLeft-r*this.stepPx*t*(e.altKey?4:1)),this.renderAll()}else i&&(this.current=null,this.$refs.scrollY.scrollTop=this.$refs.scrollY.scrollTop+this.scrollStep*t)}},addMouseDown(e){this.oldDownX=e.pageX,this.oldDownY=e.pageY,this.mouseDownX=e.offsetX,this.mouseDownY=e.offsetY,clearTimeout(this.timer),e.offsetX>this.colWidth&&e.offsetY>this.rowHeight*2&&(document.body.style.cursor="grabbing",document.onselectstart=()=>!1,document.ondragstart=()=>!1,document.addEventListener("mousemove",this.dragCanvas))},addMouseUp(){if(document.body.style.cursor="",document.onselectstart=()=>null,document.ondragstart=null,document.removeEventListener("mousemove",this.dragCanvas),Date.now()-this.stepTime>10)return;let e=this.animationStepX*60,t=this.animationStepY*60,i=this.animationStepX,l=this.animationStepY,r=0,s=0,n=()=>{let u=r,o=s;r=We(this.animationStepX/e)||0,s=We(this.animationStepY/t)||0,this.animationStepX+=i,this.animationStepY+=l;let h=this.$refs.scrollX.scrollLeft,c=this.$refs.scrollY.scrollTop,a=(r-u)*e,p=(s-o)*t;this.$refs.scrollX.scrollLeft-=a,this.$refs.scrollY.scrollTop-=p,!(h===this.$refs.scrollX.scrollLeft&&c===this.$refs.scrollY.scrollTop)&&(a>-1&&a<1&&p>-1&&p<1||(this.animationStepX!==e||this.animationStepY!==t)&&(this.timer=setTimeout(()=>{n()},25)))};n()},dragCanvas(e){let t=e.pageX,i=e.pageY,l=t-this.oldDownX,r=i-this.oldDownY;this.animationStepX=l,this.animationStepY=r,this.stepTime=Date.now(),this.oldDownX=t,this.oldDownY=i,this.$refs.scrollX.scrollLeft-=l,this.$refs.scrollY.scrollTop-=r},calcRender(){this.rowIndex=-1;let e=t=>{t.forEach((i,l)=>{switch(this.rowIndex++,i.ado=[],i.rect=[],i.data&&this.calcRect(i),!0){case i.type==="multistage":this.calcTableVertical(i,l);break;case i.type==="stair":this.calcTableStair(i,l);break;case[2,3].includes(i.level):this.calcTableLevel23(i,l);break}i.expand!==!1&&i.subList&&i.subList.length&&e(i.subList)})};e(this.data),this.tableLine.ado=[];for(let t=1;t<=this.rowIndex;t++){let i=(t+1)*this.rowHeight+this.offset;this.tableLine.ado.push({type:"line",crd:[[this.colWidth,i],[this.wrapWidth,i]],strokeStyle:this.lineColor,ctx:this.ctxMenu})}this.tableWidth=this.tunnelWidth,this.tableHeight=this.rowHeight*(this.rowIndex+1)+2,this.calcContentXY()},calcContentXY(){this.contentStartX=-this.translateX,this.contentEndX=this.wrapWidth-this.translateX,this.contentStartY=-this.translateY,this.contentEndY=this.wrapHeight-this.translateY,this.contentPosition=[[this.contentStartX,this.contentStartY],[this.contentEndX,this.contentStartY],[this.contentEndX,this.contentEndY],[this.contentStartX,this.contentEndY]]},calcRect(e,t){let i=this.rowIndex*this.rowHeight,l=t||(e.fixed==="y"?this.ctxRule:this.ctx),r=e.fixed==="y"?this.levelColor:this.rectColor,s=e.fixed==="y"?this.levelColor:this.rectHoverColor;e.data.forEach(n=>{let u=n.start*this.meterToPx+this.colWidth+.5,o=0;n.end?(o=n.end*this.meterToPx+this.colWidth+.5,o+=u===o?this.zeroWidth:0):o=u+this.faceWidth-.5;let h=[[u,i+1.5],[o,i+1.5],[o,i+this.rowHeight-.5],[u,i+this.rowHeight-.5]],c={};e.stripe==="thick"?(c.fillStyle=e.color,c.fillStripe=this.maxStripeColor,c.hoverFillStyle=void 0):e.stripe==="thin"&&(c.fillStripe=this.minStripeColor,c.hoverFillStyle=void 0),n.end||(c.borderRadius=4);let a={};n.tooltip&&(a.tooltip=n.tooltip);let p=[];n.levelCode&&p.push({type:"text",text:n.centerName,crd:[u+(o-u)/2,i+this.rowHeight/2],fillStyle:"#ffffff",ctx:l}),e.rect.push({crd:h,ado:[{type:"polygon",crd:h,fillStyle:r[n.level%r.length],hoverFillStyle:s[n.level%s.length],strokeStyle:"#FFFFFF",ctx:l,...c},...p],text:e.text,id:n.id,category:n.category,...a})})},calcTableVertical(e,t,i){let l=i||this.ctxMenu,{x:r,y:s}=this.destruction(),n=e.expand?0:1;e.expand&&e.subList.forEach(b=>{n++,b.expand&&b.subList&&b.subList.length&&b.subList.forEach(()=>{n++})});let u=n*this.rowHeight,o=s+u,h={};if(e.tooltip="",e.expand)this.getTextWidth(e.text,`font-size: ${this.fontSize}px`).width>u&&(h.text=e.text.substr(0,n*2),e.tooltip=e.text);else{this.calcTableStair(e,t,this.ctxMenu),e.ado[0].hoverFillStyle=this.tableHoverBgColor;let b=s+this.rowHeight/2-3,f=r+13;e.ado.push({type:"line",crd:[[f,b],[f+6,b+6],[f+12,b]],strokeStyle:"#e8eaec",lineWidth:2,lineCap:"round",ctx:l});return}let c=r+this.colw,a=c/2;e.crd=[[r,s],[c,s],[c,o],[r,o]],e.ado.push({type:"polygon",crd:e.crd,fillStyle:this.tableBgColor,hoverFillStyle:this.tableHoverBgColor,ctx:l,ext:h});let p=h.text||e.text,g=this.fontSize*1.3,S=s+u/2-g*(p.length/2)+12;p.split("").forEach((b,f)=>{e.ado.push({type:"text",text:b,crd:[a,S+f*g],font:`bold ${this.fontSize}px ${this.fontFamily}`,ctx:l})}),e.ado.push({type:"line",crd:[[a-6,s+16],[a,s+10],[a+6,s+16]],lineWidth:2,strokeStyle:"#e8eaec",lineCap:"round",ctx:l}),this.rowIndex--},calcTableStair(e,t,i){let{x:l,y:r}=this.destruction();e.crd=[[l,r],[l,r+this.rowHeight],[l+this.colWidth,r+this.rowHeight],[l+this.colWidth,r]],e.ado.push({type:"polygon",crd:e.crd,fillStyle:this.tableBgColor,ctx:i||this.ctxFixed}),e.ado.push({type:"text",text:e.text,crd:[(l+this.colWidth)/2,r+this.rowHeight/2],font:`bold ${this.fontSize}px ${this.fontFamily}`,ctx:i||this.ctxFixed})},calcTableLevel23(e,t,i){let l=i||this.ctxMenu,{x:r,y:s}=this.destruction();e.crd=[[r+this.colw,s],[r+this.colWidth,s],[r+this.colWidth,s+this.rowHeight],[r+this.colw,s+this.rowHeight]],e.ado.push({type:"polygon",crd:e.crd,fillStyle:e.level===3?this.tableLevel3BgColor:this.tableBgColor,hoverFillStyle:["","",this.tableHoverBgColor,this.tableLevel3BgColor][e.level],ctx:l});let n=(r+this.colWidth-this.colw)/2+this.colw;if(e.tip){let u=this.getTextWidth(e.tip,`font-size: ${this.fontSize}px`).width/2+2,o=this.getTextWidth(e.text,`font-size: ${this.fontSize}px`).width/2+2;e.ado.push({type:"text",text:e.text+"(",crd:[n-u,s+this.rowHeight/2],ctx:l}),e.ado.push({type:"text",text:e.tip,crd:[n+o,s+this.rowHeight/2],fillStyle:"#2D8CF0",ctx:l}),e.ado.push({type:"text",text:")",crd:[n+o+u+2,s+this.rowHeight/2],ctx:l})}else if(e.info){e.ado.push({type:"text",text:e.info,font:`bold 13px ${this.fontFamily}`,crd:[n,s+this.rowHeight/3-1.5],ctx:l}),e.ado.push({type:"text",text:e.text,font:`${this.fontSize*.8}px ${this.fontFamily}`,crd:[n,s+this.rowHeight/4*3+1.5],ctx:l});let u=e.expand?1:-1;(e.subList||[]).length&&e.ado.push({type:"polygon",crd:[[n-5,s+this.rowHeight/2-3*u],[n+5,s+this.rowHeight/2-3*u],[n,s+this.rowHeight/2+3*u]],fillStyle:e.expand?"#4FA5FF":"#D3DCE6",stroke:!1,ctx:l})}else{let u={};this.getTextWidth(e.text,`font-size: ${this.fontSize}px`).width>this.colWidth-this.colw&&(u.text=e.text.substr(0,7)+"...",e.tooltip=e.text),e.ado.push({type:"text",text:e.text,font:`${this.fontSize*.8}px ${this.fontFamily}`,crd:[n,s+this.rowHeight/2],ctx:l,...u})}},calcLineTableData(){let e=[],t=i=>{i.forEach(l=>{e.push(l),l.expand!==!1&&l.subList&&l.subList.length&&t(l.subList)})};t(this.data),this.lineTableData=e},calcTunnelWidth(){this.tunnelWidth=(this.endPileNo-this.startPileNo)*this.meterToPx+this.colWidth+20},destruction(){return{x:this.lineWidth-this.offset,y:this.rowIndex*this.rowHeight+this.lineWidth-this.offset}},renderAll(){console.log("\u5168\u5C40\u7ED8\u5236\uFF08\u91CD\u7ED8\uFF09"),this.$nextTick(()=>{this.calcRender(),this.renderRule(),this.renderNodes(),this.renderFixed()})},renderNodes(){this.ctxFixed.clearRect(0,0,this.colWidth,this.wrapHeight),this.tableMenu.width=this.tableMenu.width,this.ctxMenu.setTransform(1,0,0,1,0,this.translateY);let e=2*this.rowHeight-this.translateY,t=this.wrapHeight-this.translateY;this.ctxMenu.rect(0,e,this.wrapWidth,t),this.ctxMenu.clip(),this.lineTableData.forEach(i=>{this.render(i)}),this.translateY&&this.renderScrollShadow(this.ctxMenu,[0,e-10,this.wrapWidth,10]),this.translateX&&this.$nextTick(()=>{this.renderScrollShadow(this.ctxRule,[this.colWidth-this.translateX-10,0,10,this.rowHeight*(this.rowIndex+1)])}),this.$nextTick(()=>{this.render(this.tableLine)}),this.chart.width=this.chart.width,this.ctx.setTransform(1,0,0,1,this.translateX,this.translateY),this.ctx.rect(this.colWidth+1.5-this.translateX,this.rowHeight*2+this.offset-this.translateY,this.wrapWidth,this.rowHeight*(this.rowIndex-1)),this.ctx.clip(),this.ctx.save(),this.ctx.fillStyle=this.innerWrapBgColor,this.ctx.fill(),this.ctx.restore(),this.lineRectData.forEach(i=>{if(!i)return;let[,l]=i.crd[0],r=l<=this.contentEndY&&l>=this.contentStartY;i.fixed==="y"&&(r=!0),r&&i.rect.forEach(s=>{let[n]=s.crd[0],[u]=s.crd[1];!(n>this.contentEndX&&u>this.contentEndX||n<this.contentStartX&&u<this.contentStartX)&&this.render(s)})})},renderScrollShadow(e,t){e.save(),e.shadowBlur=10,e.fillStyle="red",e.shadowColor="rgba(0, 0, 0, .3)",e.fillRect(...t),e.restore()},render(e,t){let i={};(e.ado||[]).forEach(l=>{switch(l.type){case"text":i={...l},t&&(i.ctx=t),this.drawText(i);break;case"polygon":i={...l},this.current===e&&i.hoverFillStyle&&(i.fillStyle=i.hoverFillStyle),t&&(i.ctx=t),this.drawPolygon(i);break;case"line":i={...l},t&&(i.ctx=t),this.drawLine(i);break}})},renderRule(e){let t=e||this.ctxRule;e||(this.tableRule.width=this.tableRule.width,t.setTransform(1,0,0,1,this.translateX,0),t.rect(this.colWidth-this.translateX,0,this.wrapWidth,this.wrapHeight),t.clip());let i=Math.floor(Math.abs(this.translateX)/this.ruleStep)+1,l=Math.ceil((Math.abs(this.translateX)+this.wrapWidth)/this.ruleStep)+1;this.rules.ado=[],this.rules.startX=i+this.startPileNo;for(let s=i;s<l;s++){let n=this.colWidth+s*this.ruleStep-this.offset;this.rules.ado.push({type:"line",crd:[[n,this.ruleHeight],[n,this.ruleHeight+this.tickLength]],ctx:t});let u=this.ruleHeight/2+2,o=s*this.ruleStepVal;if(this.rules.ado.push({type:"text",crd:[n,u],text:o,fillStyle:this.tickTextColor,font:`${this.tickFontSize*(this.ruleStep>=100?1.1:1)}px ${this.fontFamily}`,ctx:t}),this.ruleStep>=100){let h=0;this.ruleStep>=100&&(h=2),this.ruleStep>=200&&(h=5),this.ruleStep>=400&&(h=10),this.ruleStep>=800&&(h=20),this.ruleStep>=1500&&(h=50),this.ruleStep>=3e3&&(h=100);let c=this.ruleStep/h;for(let a=1;a<h;a++){let p=n+c*a-this.ruleStep;this.rules.ado.push({type:"text",crd:[p,u],text:o+this.ruleStepVal/h*a-this.ruleStepVal,fillStyle:this.tickTextColor,font:`${this.tickFontSize*.75}px ${this.fontFamily}`,ctx:t}),this.rules.ado.push({type:"line",crd:[[p,this.ruleHeight],[p,this.ruleHeight+this.tickLength-4]],ctx:t})}}}this.render(this.rules),this.shaft.ado=[];let r="#90A5BA";(this.shaft.originData||[]).forEach(s=>{let n=this.pileNoToCrd(s.startPileNo)+this.colWidth;this.shaft.ado.push({type:"line",crd:[[n,0],[n,this.tableHeight]],ctx:t,strokeStyle:"#FFFFFF",lineWidth:2}),this.shaft.ado.push({type:"line",crd:[[n,0],[n,this.tableHeight]],ctx:t,strokeStyle:r,lineWidth:2,setLineDash:[2,2]}),this.shaft.ado.push({type:"text",text:`${s.name} ${s.startPileStr}`,crd:[n+40,this.ruleHeight+this.tipHeight/2+2],textAlign:"start",fillStyle:this.pileStrColor,ctx:t}),this.shaft.ado.push({type:"polygon",crd:[[n-6,0],[n+6,0],[n,7]],fillStyle:r,stroke:!1,ctx:t});let u=this.ruleHeight;[n,n-25].forEach((o,h)=>{let c=o+this.tipHeight,a=u+this.tipHeight,p=h?c:o,g=h?o:c,S=h?-1:1,b=p+8*S,f=p+18*S,y=[[b,a-(this.ruleHeight/2-3)],[f,a-(this.ruleHeight/2-3)],[f,a-(this.ruleHeight/2-6)],[g,a-this.ruleHeight/2],[f,a-(this.ruleHeight/2+6)],[f,a-(this.ruleHeight/2+3)],[b,a-(this.ruleHeight/2+3)],[b,u]];this.shaft.ado.push({type:"polygon",crd:y,fillStyle:r,ctx:t})})}),this.$nextTick(()=>{this.render(this.shaft)})},renderFixed(e){let t=e||this.ctxFixed;!e&&t.clearRect(this.colWidth+1,0,this.wrapWidth,this.rowHeight*2),[this.lineWidth,this.ruleHeight,this.rowHeight].forEach(o=>{o-=this.offset,this.drawLine({crd:[[this.colWidth,o],[this.wrapWidth,o]],ctx:t})});let i=this.colWidth-this.offset+1,l=this.ruleHeight-this.offset,r=Math.round(Math.abs(this.translateX)/this.ruleStep*100)+this.startPileNo,s=Math.round((Math.abs(this.translateX)+this.wrapWidth-this.colWidth)/this.ruleStep*100)+this.startPileNo,n=`K${Math.floor(r/1e3)}+${r%1e3}`,u=`K${Math.floor(s/1e3)}+${s%1e3}`;[i,this.wrapWidth-this.ruleHeight-this.offset].forEach((o,h)=>{let c=o+this.tipHeight,a=l+this.tipHeight;this.drawPolygon({crd:[[o,l],[c,l],[c,a],[o,a]],fillStyle:this.inOutIconBgColor,ctx:t});let p=h?c:o,g=h?o:c,S=h?-1:1,b=this.tipHeight*.23,f=p+b*S,y=p+(b+2)*S,k=p+(this.tipHeight-4)*S,K=[[f,l],[f,a],[y,a],[y,a-(this.ruleHeight/2-1)],[k,a-(this.ruleHeight/2-1)],[k,a-(this.ruleHeight/2-4)],[g,a-this.ruleHeight/2],[k,a-(this.ruleHeight/2+4)],[k,a-(this.ruleHeight/2+1)],[y,a-(this.ruleHeight/2+1)],[y,l]];this.drawPolygon({crd:K,fillStyle:this.inOutIconColor,ctx:t});let x={};h&&(o+=this.ruleHeight,x.textAlign="right"),this.drawText({crd:[o+(this.ruleHeight+10)*S,l+this.tipHeight/2+2],text:S===1?n:u,fillStyle:this.pileStrColor,textAlign:"start",ctx:t,...x})})},pileNoToCrd(e){return(e-this.startPileNo)*this.meterToPx||0},drawPolygon(e,t){let i=e.crd.concat();if(t=e.ctx||t||this.ctx,t.save(),t.strokeStyle=e.strokeStyle||this.lineColor,t.fillStyle=e.fillStyle||this.fillStyle,t.lineWidth=e.lineWidth||this.lineWidth,e.hoverFillStyle){let l=i.map(h=>h[0]),r=Math.max(...l),s=Math.min(...l),n=i.map(h=>h[1]),u=Math.max(...n),o=Math.min(...n);t.clearRect(s,o,r-s,u-o)}if(t.beginPath(),e.borderRadius){let l=e.borderRadius,[r,s]=i.shift(),n=r-(r-i[0][0])/2;t.moveTo(n,s);do{let[u,o]=i.shift(),[h,c]=i[0]||[r,s],a=u-(u-h)/2,p=o-(o-c)/2;t.arcTo(u,o,a,p,l)}while(i.length);t.arcTo(r,s,n,s,l)}else{t.moveTo(...i.shift());do t.lineTo(...i.shift());while(i.length)}if(e.closePath!==!1&&t.closePath(),t.strokeStyle=e.strokeStyle,e.stroke!==!1&&t.stroke(),e.fillStyle&&t.fill(),t.restore(),e.fillStripe){t.save();let l=e.crd.concat();t.fillStyle=e.fillStripe,t.globalAlpha=e.globalAlpha||1,t.beginPath(),t.moveTo(...l.shift());do t.lineTo(...l.shift());while(l.length);t.closePath(),t.fill(),t.restore()}},drawLine(e,t){let i=e.crd.concat();t=e.ctx||t||this.ctx,t.save(),t.strokeStyle=e.strokeStyle||this.lineColor,t.lineCap=e.lineCap||t.lineCap,t.lineWidth=e.lineWidth||this.lineWidth,e.setLineDash&&t.setLineDash(e.setLineDash),t.beginPath(),t.moveTo(...i.shift());do t.lineTo(...i.shift());while(i.length);t.stroke(),t.restore()},drawText(e,t){t=e.ctx||t||this.ctx,t.save(),t.textBaseline=e.textBaseline||"middle",t.textAlign=e.textAlign||"center",t.font=e.font||`${this.fontSize}px ${this.fontFamily}`,t.fillStyle=e.fillStyle||this.fontColor,t.fillText(e.text,...e.crd),t.restore()},isInnerPolygon(e,t){let[i,l]=e,r=!1;for(let s=0,n=t.length-1;s<t.length;n=s++){let[u,o]=t[s],[h,c]=t[n];o>l!=c>l&&i<(h-u)*(l-o)/(c-o)+u&&(r=!r)}return r},getTextWidth(e,t){let i=document.createElement("div");i.setAttribute("style",`position: fixed; left: -100000px; opacity: 0; ${t}`),i.innerHTML=e,document.body.appendChild(i);let l=i.getBoundingClientRect();return document.body.removeChild(i),l},renderAllNodesAndDownload(){let e=document.createElement("canvas"),t=e.getContext("2d"),i=JSON.parse(JSON.stringify(this.data)),l=this.rowIndex;this.rowIndex=-1;let r=b=>{b.forEach(f=>{f.expand!==void 0&&(f.expand=!0),f.subList&&f.subList.length&&r(f.subList)})};r(i);let s=this.translateX;this.translateX=0;let n=[],u=[],o=b=>{b.forEach((f,y)=>{switch(u.push(f),(!f.subList||f.level!==1)&&n.push(f),this.rowIndex++,f.ado=[],f.rect=[],f.data&&this.calcRect(f,t),!0){case f.type==="multistage":this.calcTableVertical(f,y,t);break;case f.type==="stair":this.calcTableStair(f,y,t);break;case[2,3].includes(f.level):this.calcTableLevel23(f,y,t);break}f.subList&&f.subList.length&&o(f.subList)})};o(i),this.rowIndex=l;let h=this.tunnelWidth,c=n.length*this.rowHeight;e.height=c+2,e.width=h;let a=this.tableHeight;this.tableHeight=c;let p=this.wrapWidth;this.wrapWidth=h,t.fillStyle=this.innerWrapBgColor,t.fillRect(this.colWidth,this.rowHeight,h,c),u.forEach(b=>{this.render(b,t),b.rect&&b.rect.forEach(f=>{this.render(f,t)})}),this.renderRule(t),this.renderFixed(t);let g={ado:[]},S=Math.floor(c/this.rowHeight)-1;for(let b=1;b<=S;b++){let f=(b+1)*this.rowHeight+this.offset;g.ado.push({type:"line",crd:[[this.colWidth,f],[h,f]],strokeStyle:this.lineColor})}this.render(g,t),this.wrapWidth=p,this.translateX=s,this.tableHeight=a,this.$nextTick(()=>{let b=e.toDataURL("image/png"),f=document.createElement("a");f.href=b,f.download="\u65BD\u5DE5\u8FDB\u5EA6\u56FE.png";let y=document.createEvent("MouseEvents");y.initEvent("click",!0,!1),f.dispatchEvent(y)})},printHandle(e){let t=e.toDataURL("image/png"),i=window.open();i.document.write=`<img src='${t}'/>`,i.print()}},destroyed(){let e=this.canvasWrap;e&&(ci(e,this.listenVessel),e.removeEventListener("mousemove",this.addMouseMove),e.removeEventListener("mouseleave",this.addMouseLeave),e.removeEventListener("mouseenter",this.addMouseWhell),e.removeEventListener("mousedown",this.addMouseDown),e.removeEventListener("click",this.addMouseClick),document.removeEventListener("mouseup",this.addMouseUp),document.removeEventListener("keydown",this.keyDownHandle),document.removeEventListener("keyup",this.keyUpHandle))}};const pi="K000+000",bi="0",gi="K5+000",vi="5000",mi="1.\u6BD4\u4F8B\u7F29\u653E\uFF1A\u9F20\u6807\u5728\u753B\u5E03\u5185\u65F6\u652F\u6301 Ctrl + \u6EDA\u8F6E \u7F29\u653E\uFF0CCtrl + alt + \u6EDA\u8F6E \u5FEB\u901F\u7F29\u653E\uFF1B   2.\u6A2A\u5411\u6EDA\u52A8\uFF1A\u9F20\u6807\u5728\u753B\u5E03\u5185\u65F6\u652F\u6301 shift + \u6EDA\u8F6E \u6A2A\u5411\u6EDA\u52A8\uFF0Cshift + alt + \u6EDA\u8F6E \u5FEB\u901F\u6A2A\u5411\u6EDA\u52A8   3.\u753B\u5E03\u62D6\u62FD\uFF1A \u9F20\u6807\u5728\u753B\u5E03\u5185\u53EF\u62D6\u62FD\u753B\u5E03   4.\u4E0B\u8F7D\u652F\u6301\uFF1A\u6839\u636E\u5F53\u524D\u7F29\u653E\u6BD4\u4F8B\u4E0B\u8F7D\uFF0C\u6700\u5927\u652F\u630165000px \u5BBD\u5EA6\u753B\u5E03;   5.\u5BBD\u9AD8\u81EA\u9002\u5E94\uFF1A\u5207\u6362\u5BBD\u9AD8\u81EA\u52A8\u91CD\u65B0\u7ED8\u5236\u753B\u5E03\u5185\u5BB9",xi=[{id:"4f9dfeaa-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"0",endPileNo:"1100",startPileNoStr:"K000+000",endPileNoStr:"K1+100",levelId:"fad026e8e09741d987c4b7346e3783d4",levelName:"\u2160\u7EA7",levelCode:"surrounding_rock_classification-\u2160",levelType:"0",remark:""},{id:"4f9e0095-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"1100",endPileNo:"2200",startPileNoStr:"K1+100",endPileNoStr:"K2+200",levelId:"96f81ff4bd504b17a630b266147bad06",levelName:"\u2162\u7EA7",levelCode:"surrounding_rock_classification-\u2162",levelType:"0",remark:""},{id:"4f9e0120-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"2200",endPileNo:"3300",startPileNoStr:"K2+200",endPileNoStr:"K3+300",levelId:"820aed7377274d1e9aa09f6c57eb5524",levelName:"\u2164\u7EA7",levelCode:"surrounding_rock_classification-\u2164",levelType:"0",remark:""},{id:"4f9e01a3-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"3300",endPileNo:"4400",startPileNoStr:"K3+300",endPileNoStr:"K4+400",levelId:"f4e852ba0c414f25855ab961eccc97cc",levelName:"\u2161\u7EA7",levelCode:"surrounding_rock_classification-\u2161",levelType:"0",remark:""},{id:"4f9e0213-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"4400",endPileNo:"4600",startPileNoStr:"K4+400",endPileNoStr:"K4+600",levelId:"10b2f3b220ab44acbef990aa6945697e",levelName:"\u2163\u7EA7",levelCode:"surrounding_rock_classification-\u2163",levelType:"0",remark:""},{id:"4f9e028f-727d-11eb-9fe2-0242ac110006",tunnelId:"92627b5b5b4240acb67c0078f2b312da",paramTunnelTrunk:"353e9b1ec6b846baad0296434c73e4b6",tunnelTrunkName:"\u5355\u6D1E",startPileNo:"4600",endPileNo:"5000",startPileNoStr:"K4+600",endPileNoStr:"K5+000",levelId:"53bc75c179a141179ce9da05913544df",levelName:"\u2165\u7EA7",levelCode:"surrounding_rock_classification-\u2165",levelType:"0",remark:""}],wi=[],yi=null,Pi=null,Si=[{name:"\u660E\u6D1E\u53CA\u6D1E\u95E8",progressPercent:null,subList:[{name:"\u660E\u6D1E\u56DE\u586B",progressPercent:null,subList:null,dataList:[{id:"a4928b7c-84a7-43a9-83ec-dc91ede81960",name:null,startPileStr:"K0+080",startPileNo:"80",endPileStr:"K0+090",endPileNo:"90",progressPercent:null,scoreLevel:"0"}]},{name:"\u6321\u5899\u780C\u7B51",progressPercent:null,subList:null,dataList:[{id:"efa81292-3982-48a2-8512-589a714f813a",name:null,startPileStr:"K0+060",startPileNo:"60",endPileStr:"K0+080",endPileNo:"80",progressPercent:null,scoreLevel:"2"},{id:"8e15aa7e-641b-4ebf-ba57-5dfc4443a11a",name:null,startPileStr:"K0+050",startPileNo:"50",endPileStr:"K0+055",endPileNo:"55",progressPercent:null,scoreLevel:"0"},{id:"c7b0a35f-953a-4c69-adb2-8a80fe46601d",name:null,startPileStr:"K4+050",startPileNo:"4050",endPileStr:"K4+100",endPileNo:"4100",progressPercent:null,scoreLevel:"3"}]},{name:"\u660E\u6D1E\u6392\u6C34",progressPercent:null,subList:null,dataList:[{id:"b69cd7e2-bfca-4d34-93c8-816a762bc57b",name:null,startPileStr:"K0+070",startPileNo:"70",endPileStr:"K0+080",endPileNo:"80",progressPercent:null,scoreLevel:"4"}]},{name:"\u660E\u6D1E\u94A2\u7B4B",progressPercent:null,subList:null,dataList:[{id:"0f40f1fb-d2ce-47d8-b4d0-7d43cd6d4853",name:null,startPileStr:"K0+120",startPileNo:"120",endPileStr:"K0+150",endPileNo:"150",progressPercent:null,scoreLevel:"5"},{id:"8bd22b76-a1f0-4ae6-a057-e88f490393ae",name:null,startPileStr:"K0+100",startPileNo:"100",endPileStr:"K0+130",endPileNo:"130",progressPercent:null,scoreLevel:"4"},{id:"52e58e95-5482-446c-9ea0-e9b321123253",name:null,startPileStr:"K0+050",startPileNo:"50",endPileStr:"K0+060",endPileNo:"60",progressPercent:null,scoreLevel:"2"}]},{name:"\u57FA\u7840",progressPercent:null,subList:null,dataList:[{id:"7642d7fe-a424-4506-8c17-873f2eab253a",name:null,startPileStr:"K0+050",startPileNo:"50",endPileStr:"K0+055",endPileNo:"55",progressPercent:null,scoreLevel:"1"},{id:"315ff61c-5ea2-4cdb-8cb4-eb87765e4950",name:null,startPileStr:"K0+045",startPileNo:"45",endPileStr:"K0+050",endPileNo:"50",progressPercent:null,scoreLevel:"5"},{id:"3d1d40b9-89f5-4dff-b532-8b54033b31b9",name:null,startPileStr:"K0+030",startPileNo:"30",endPileStr:"K0+035",endPileNo:"35",progressPercent:null,scoreLevel:"4"},{id:"42db56ef-f0bd-4dd4-a82a-7abefac3f6ef",name:null,startPileStr:"K0+010",startPileNo:"10",endPileStr:"K0+020",endPileNo:"20",progressPercent:null,scoreLevel:"4"},{id:"2ddc5007-31c9-4715-90ef-7f06a409b951",name:null,startPileStr:"K0+000",startPileNo:"0",endPileStr:"K0+010",endPileNo:"10",progressPercent:null,scoreLevel:"4"},{id:"132d486f-86ce-452c-9a35-aaf199cd57b8",name:null,startPileStr:"K0+020",startPileNo:"20",endPileStr:"K0+050",endPileNo:"50",progressPercent:null,scoreLevel:"5"},{id:"8f7e12a1-ec2f-41e1-bf62-9fa64ce16d23",name:null,startPileStr:"K4+250",startPileNo:"4250",endPileStr:"K4+250",endPileNo:"4250",progressPercent:null,scoreLevel:"4"},{id:"db6ba73d-1bae-4753-901b-23aa61f6444a",name:null,startPileStr:"K4+415",startPileNo:"4415",endPileStr:"K4+250",endPileNo:"4250",progressPercent:null,scoreLevel:"5"},{id:"23a138fb-53fa-4dd1-b93a-0cacf2975223",name:null,startPileStr:"K4+300",startPileNo:"4300",endPileStr:"K4+400",endPileNo:"4400",progressPercent:null,scoreLevel:"2"},{id:"3d5e1179-a29c-4c0e-bb95-b169eb2dbbf0",name:null,startPileStr:"K4+100",startPileNo:"4100",endPileStr:"K4+200",endPileNo:"4200",progressPercent:null,scoreLevel:"5"},{id:"a9db3c00-4284-4d87-a036-a96a2148cb25",name:null,startPileStr:"K53+100",startPileNo:"53100",endPileStr:"K55+200",endPileNo:"55200",progressPercent:null,scoreLevel:"0"}]},{name:"\u660E\u6D1E\u886C\u780C",progressPercent:null,subList:null,dataList:[{id:"6a6d815b-d2c6-4d7e-bc22-91b773cc54dd",name:null,startPileStr:"K0+090",startPileNo:"90",endPileStr:"K0+110",endPileNo:"110",progressPercent:null,scoreLevel:"4"},{id:"3b296752-9f9f-42ea-ae9b-d4570133912a",name:null,startPileStr:"K0+060",startPileNo:"60",endPileStr:"K0+070",endPileNo:"70",progressPercent:null,scoreLevel:"3"},{id:"46537ffc-6755-45c3-a87a-696778b7ae50",name:null,startPileStr:"K0+020",startPileNo:"20",endPileStr:"K0+030",endPileNo:"30",progressPercent:null,scoreLevel:"4"}]}],dataList:null},{name:"\u4EF0\u62F1\u53CA\u94FA\u5E95",progressPercent:null,subList:[{name:"\u4EF0\u62F1\u9632\u6C34\u5C42\u94FA\u8BBE",progressPercent:null,subList:null,dataList:[{id:"3c9570e6-791e-4c46-bb2b-1072c242d218",name:null,startPileStr:"K0+035",startPileNo:"35",endPileStr:"K0+045",endPileNo:"45",progressPercent:null,scoreLevel:"3"}]},{name:"\u4EF0\u62F1\u521D\u652F\u94A2\u7B4B\u7F51",progressPercent:null,subList:null,dataList:[{id:"6898ff39-7813-4c3a-9f26-32aa1e856cd6",name:null,startPileStr:"K0+020",startPileNo:"20",endPileStr:"K0+030",endPileNo:"30",progressPercent:null,scoreLevel:"2"}]},{name:"\u5F00\u6316",progressPercent:null,subList:null,dataList:[{id:"c0c20b71-cf60-4597-8241-2c113c776ac1",name:null,startPileStr:"K0+003",startPileNo:"3",endPileStr:"K0+005",endPileNo:"5",progressPercent:null,scoreLevel:"5"},{id:"8c7db21c-54f7-40f8-af75-3f3dbd708d94",name:null,startPileStr:"K4+200",startPileNo:"4200",endPileStr:"K4+300",endPileNo:"4300",progressPercent:null,scoreLevel:"4"}]}],dataList:null},{name:"\u521D\u671F\u652F\u62A4",progressPercent:null,subList:[{name:"\u521D\u55B7",progressPercent:null,subList:null,dataList:[{id:"016f1190-6974-46df-ab12-db1f074694e2",name:null,startPileStr:"K0+080",startPileNo:"80",endPileStr:"K0+085",endPileNo:"85",progressPercent:null,scoreLevel:"0"},{id:"12ad55ab-6e86-459e-b60d-51f67ca5990a",name:null,startPileStr:"K4+450",startPileNo:"4450",endPileStr:"K4+500",endPileNo:"4500",progressPercent:null,scoreLevel:"4"},{id:"dd8a7f7e-b95d-4678-a7c5-bf0335be3699",name:null,startPileStr:"K4+200",startPileNo:"4200",endPileStr:"K4+200",endPileNo:"4200",progressPercent:null,scoreLevel:"3"}]},{name:"\u94A2\u7B4B\u7F51",progressPercent:null,subList:null,dataList:[{id:"09d8faa2-1ad3-4c03-aa9d-ea572227fa38",name:null,startPileStr:"K0+100",startPileNo:"100",endPileStr:"K0+110",endPileNo:"110",progressPercent:null,scoreLevel:"1"}]}],dataList:null},{name:"\u7535\u7F06\u69FD\u3001\u4E2D\u5FC3\u6392\u6C34\u6C9F",progressPercent:null,subList:[{name:"\u94A2\u7B4B",progressPercent:null,subList:null,dataList:[{id:"65bd2a67-ea01-4fa5-8e17-f11d8ba082f9",name:null,startPileStr:"K0+055",startPileNo:"55",endPileStr:"K0+075",endPileNo:"75",progressPercent:null,scoreLevel:"4"},{id:"db3f29fe-f22f-468d-8175-b5e55a347abd",name:null,startPileStr:"K0+002",startPileNo:"2",endPileStr:"K0+005",endPileNo:"5",progressPercent:null,scoreLevel:"2"}]},{name:"\u5F00\u6316",progressPercent:null,subList:null,dataList:[{id:"eb2fba6c-4fca-45d8-8298-ec3785fca436",name:null,startPileStr:"K0+055",startPileNo:"55",endPileStr:"K0+060",endPileNo:"60",progressPercent:null,scoreLevel:"0"},{id:"e8f3cebb-946d-411c-8a70-df58ae1d6589",name:null,startPileStr:"K0+050",startPileNo:"50",endPileStr:"K0+055",endPileNo:"55",progressPercent:null,scoreLevel:"0"},{id:"c4d13f3d-7f24-47c8-bca6-1ac8d21c625c",name:null,startPileStr:"K4+700",startPileNo:"4700",endPileStr:"K4+800",endPileNo:"4800",progressPercent:null,scoreLevel:"4"}]}],dataList:null},{name:"\u9632\u5BD2\u6CC4\u6C34\u6D1E\u51FA\u6C34\u53E3",progressPercent:null,subList:[{name:"\u5206\u5C42\u94FA\u7B51\u8FC7\u7A0B",progressPercent:null,subList:null,dataList:[{id:"feb7f696-1292-43cf-a00e-aaa524ef19c0",name:null,startPileStr:"K0+085",startPileNo:"85",endPileStr:"K0+089",endPileNo:"89",progressPercent:null,scoreLevel:"4"}]}],dataList:null},{name:"\u62F1\u5899\u9632\u6392\u6C34",progressPercent:null,subList:[{name:"\u9632\u6C34\u5C42\u94FA\u8BBE\u524D\u521D\u652F\u72B6\u51B5",progressPercent:null,subList:null,dataList:[{id:"d5f220d6-43b6-4ca1-b0cb-692da371cb1d",name:null,startPileStr:"K0+000",startPileNo:"0",endPileStr:"K0+010",endPileNo:"10",progressPercent:null,scoreLevel:"0"},{id:"742e29f2-bbb4-4be7-b76b-fc2d3138d946",name:null,startPileStr:"K4+300",startPileNo:"4300",endPileStr:"K4+350",endPileNo:"4350",progressPercent:null,scoreLevel:"3"}]},{name:"\u6392\u6C34\u7BA1",progressPercent:null,subList:null,dataList:[{id:"ee47c454-1d74-4201-ba12-d1e803b2d6f0",name:null,startPileStr:"K0+010",startPileNo:"10",endPileStr:"K0+050",endPileNo:"50",progressPercent:null,scoreLevel:"5"}]},{name:"\u9884\u7559\u6D1E\u5BA4\u9632\u6C34\u5C42\u94FA\u8BBE\u524D\u521D\u652F\u72B6\u51B5",progressPercent:null,subList:null,dataList:[{id:"2808a70b-c56e-4418-85cf-17de67a37589",name:null,startPileStr:"K0+030",startPileNo:"30",endPileStr:"K0+030",endPileNo:"30",progressPercent:null,scoreLevel:"5"}]}],dataList:null},{name:"\u5916\u7F6E\u4FDD\u6E29\u5C42",progressPercent:null,subList:[{name:"\u4FDD\u6E29\u5C42",progressPercent:null,subList:null,dataList:[{id:"27960d36-0a36-435d-ad9b-2249b0240fbc",name:null,startPileStr:"K0+010",startPileNo:"10",endPileStr:"K0+030",endPileNo:"30",progressPercent:null,scoreLevel:"5"},{id:"e37196d3-5430-427c-8352-1ac79938ead6",name:null,startPileStr:"K0+004",startPileNo:"4",endPileStr:"K0+004",endPileNo:"4",progressPercent:null,scoreLevel:"3"}]}],dataList:null},{name:"\u4E8C\u886C",progressPercent:null,subList:[{name:"\u886C\u780C\u94A2\u7B4B",progressPercent:null,subList:null,dataList:[{id:"a7fca37d-a96b-4bb4-80c6-34d42dad3744",name:null,startPileStr:"K4+550",startPileNo:"4550",endPileStr:"K4+600",endPileNo:"4600",progressPercent:null,scoreLevel:"5"}]},{name:"\u5185\u7F6E\u4FDD\u6E29\u5C42",progressPercent:null,subList:null,dataList:[{id:"3ca2dd7e-c990-4cf1-b0fe-524656d0ad87",name:null,startPileStr:"K0+004",startPileNo:"4",endPileStr:"K0+009",endPileNo:"9",progressPercent:null,scoreLevel:"1"}]}],dataList:null},{name:"\u5F00\u6316",progressPercent:null,subList:[{name:"\u638C\u5B50\u9762\u56F4\u5CA9",progressPercent:null,subList:null,dataList:[{id:"ef077ad8-3c9f-472b-8d15-e256fbe5ae76",name:null,startPileStr:"K0+110",startPileNo:"110",endPileStr:null,endPileNo:null,progressPercent:null,scoreLevel:"5"},{id:"bc0f6638-3682-4021-87e5-1766c62e6bba",name:null,startPileStr:"K0+090",startPileNo:"90",endPileStr:null,endPileNo:null,progressPercent:null,scoreLevel:"4"},{id:"d54c4a90-d92c-41c3-85aa-addc7658a857",name:null,startPileStr:"K0+070",startPileNo:"70",endPileStr:null,endPileNo:null,progressPercent:null,scoreLevel:"1"},{id:"3617bc1c-1e4b-4ef0-aa09-4ab90930cf5e",name:null,startPileStr:"K0+030",startPileNo:"30",endPileStr:null,endPileNo:null,progressPercent:null,scoreLevel:"4"},{id:"9b77c577-7d94-4b60-ad4d-aaa179f5b42b",name:null,startPileStr:"K4+200",startPileNo:"4200",endPileStr:"K4+200",endPileNo:"4200",progressPercent:null,scoreLevel:"4"}]}],dataList:null}];var M={startPileStr:pi,startPileNo:bi,endPileStr:gi,endPileNo:vi,tunnelIntroduction:mi,designInfoList:xi,slopeAndShaftList:wi,constructionProgress:yi,qualityInspection:Pi,processIma:Si};const De=e=>(tt("data-v-42e0f136"),e=e(),it(),e),_i={class:"statistic-analysis-wrapper"},Li=Se("\u5B9A\u4F4D"),Ni=Se("\u5BFC\u51FA\u5206\u6790\u56FE"),ki={class:"content-wrapper"},Ei={class:"inner-wrap"},Ai=De(()=>P("div",{class:"tip-title"},[P("div",{class:"current"},"\u64CD\u4F5C"),P("div",null,"\u7B80\u4ECB")],-1)),Ti={class:"tip-info-content"},Ci={class:"tunnel-name"},Mi=De(()=>P("span",{class:"el-icon-arrow-down"},null,-1)),Wi={class:"slider-wrap"},Hi={class:"tip-text"},Fi={class:"table-wrapper",ref:"tableWrap",style:{"pointer-events":"none"}},Ki={class:"canvas-container",ref:"canvasWrap"};function Vi(e,t,i,l,r,s){const n=Fe,u=nt,o=ot,h=rt,c=st,a=at,p=Ot;return A(),W("div",_i,[F(a,{class:"filter-wrapper form-inline",model:r.filterData,inline:"","label-width":"80px"},{default:Y(()=>[F(u,{label:"K","label-width":"20px"},{default:Y(()=>[F(n,{size:"small",modelValue:r.filterData.k,"onUpdate:modelValue":t[0]||(t[0]=g=>r.filterData.k=g),"controls-position":"right",min:s.kMin,max:s.kMax,precision:0},null,8,["modelValue","min","max"])]),_:1}),F(u,{label:"+","label-width":"20px"},{default:Y(()=>[F(n,{size:"small",modelValue:r.filterData.v,"onUpdate:modelValue":t[1]||(t[1]=g=>r.filterData.v=g),"controls-position":"right",min:s.vMin,max:s.vMax,step:1,precision:1},null,8,["modelValue","min","max"])]),_:1}),F(o,{size:"small",type:"primary",disabled:e.data.length<=2,onClick:s.locationHandle},{default:Y(()=>[Li]),_:1},8,["disabled","onClick"]),F(o,{size:"small",type:"primary",onClick:e.renderAllNodesAndDownload},{default:Y(()=>[Ni]),_:1},8,["onClick"]),F(u,{label:"\u884C\u9AD8","label-width":"80px"},{default:Y(()=>[F(c,{modelValue:e.rowHeight,"onUpdate:modelValue":t[2]||(t[2]=g=>e.rowHeight=g),onChange:s.changeRowHeight},{default:Y(()=>[(A(!0),W(le,null,ce(e.rowHegihtOptions,g=>(A(),he(h,{key:g,value:g,label:g},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"]),P("div",ki,[P("div",{class:R(["header-info-box clearfix",{expand:r.isHeaderExpand}])},[P("div",Ei,[Ai,P("div",Ti,[P("div",Ci,te(r.tunnelName),1),P("div",{class:"description",ref:"description"},te(r.tunnelIntroduction),513),r.descriptionWidth>r.descriptionWrapWidth?(A(),W("span",{key:0,class:"expand-btn",onClick:t[3]||(t[3]=g=>r.isHeaderExpand=!r.isHeaderExpand)},[Se(te(r.isHeaderExpand?"\u6536\u8D77":"\u8BE6\u60C5"),1),Mi])):ie("",!0)])])],2),P("div",Wi,[F(p,{modelValue:e.meterToPx,"onUpdate:modelValue":t[4]||(t[4]=g=>e.meterToPx=g),onInput:s.changeMeterHandle,step:e.stepPx,min:e.meterToPxMin,max:e.meterToPxMax},null,8,["modelValue","onInput","step","min","max"]),P("span",Hi,"\u7F29\u653E\u6BD4\u4F8B\uFF081\u7C73 = "+te(e.meterToPx)+"\u50CF\u7D20\uFF09",1)]),P("div",Fi,[P("div",Ki,null,512),P("div",{class:"dark-scrollbar vertical",ref:"scrollY",onScroll:t[5]||(t[5]=(...g)=>s.scrollHandle&&s.scrollHandle(...g))},[P("div",{style:B({height:`${e.tableHeight}px`,width:"1px"})},null,4)],544),P("div",{class:"dark-scrollbar horizontal",ref:"scrollX",onScroll:t[6]||(t[6]=(...g)=>s.scrollXHandle&&s.scrollXHandle(...g))},[P("div",{style:B({width:`${e.tableWidth}px`,height:"1px"})},null,4)],544)],512),e.current&&e.current.tooltip?(A(),W(le,{key:0},[P("div",{class:"tooltip-custom",style:B(r.tooltipStyle)},te((e.current||{}).tooltip),5),P("div",{class:"line-tip",style:B(r.lineStyle)},null,4)],64)):ie("",!0)])])}const zi={components:{},mixins:[fi],data(){return{isHeaderExpand:!1,tunnelName:"",tunnelIntroduction:"",descriptionWrapWidth:0,descriptionWidth:0,tooltipStyle:{},lineStyle:{},filterData:{id:"",projectId:"",tunnelId:"",tunnelTrunkId:"",k:0,v:0},projectOptions:[],tunnelOptions:[],tunnelTrunkOptions:[],originData:{},modalInfo:{modal:!1,title:"\u8BE6\u60C5",id:null}}},computed:{kMax(){return Math.floor(this.endPileNo/1e3)},vMax(){return this.filterData.k===this.kMax?this.endPileNo%1e3:999.9},kMin(){return Math.floor(this.startPileNo/1e3)},vMin(){return this.startPileNo%1e3}},watch:{meterToPx(e){this.calcTunnelWidth(),this.preMeterToPx=e},current:{handler(e,t){t&&this.render(t),e?(this.canvasWrap.style.cursor="pointer",this.render(e)):this.$refs.canvasWrap.style.cursor="",this.calcTooltipStyle()},deep:!0}},mounted(){this.getData()},methods:{getData(){this.originData=JSON.parse(JSON.stringify(M)),console.log("\u65BD\u5DE5\u8FDB\u5EA6\uFF1A",M.constructionProgress),console.log("\u8D28\u91CF\u68C0\u67E5\uFF1A",M.qualityInspection),console.log("\u7AD6\u4E95\u3001\u659C\u4E95\uFF1A",M.slopeAndShaftList),console.log("\u5DE5\u5E8F\u5F71\u50CF\uFF1A",M.processIma),console.log("\u56F4\u5CA9\u7EA7\u522B",M.designInfoList),this.shaft={originData:M.slopeAndShaftList||[]},this.descriptionWrapWidth=this.$refs.description.getBoundingClientRect().width-48,this.descriptionWidth=this.getTextWidth(M.tunnelIntroduction,"font-size: 15px").width,this.tunnelIntroduction=M.tunnelIntroduction,this.startPileNo=M.startPileNo>>>0,this.endPileNo=M.endPileNo>>>0,this.calcTunnelWidth(),this.$nextTick(()=>{this.filterData.k=this.kMin,this.filterData.v=this.vMin}),this.startPileStr=`\u8FDB\u53E3 ${M.startPileStr}`,this.endPileStr=`\u51FA\u53E3 ${M.endPileStr}`,this.formatData(),this.canvasWrap?this.renderAll():this.init(),setTimeout(()=>{this.$refs.tableWrap.style.pointerEvents=""},100)},formatData(){this.data=JSON.parse(JSON.stringify(this.rootData)),this.originData.designInfoList&&(this.data[1].data=(this.originData.designInfoList||[]).map(e=>{e.centerName=e.levelName,e.piles=[e.startPileNo-this.startPileNo,e.endPileNo-this.startPileNo],e.end=e.piles[1],e.start=e.piles[0],e.level=e.levelType;let i=(e.levelCode||"").toLocaleUpperCase().match(/[]/)[0];return e.tooltip=e.centerName,e.level=this.romeNumber.indexOf(i),e})),this.data.push(...JSON.parse(this.extData)),this.originData.processIma&&this.originData.processIma.length&&this.data.push({text:"\u5DE5\u5E8F\u5F71\u50CF",expand:!0,level:1,type:"multistage",subList:this.recursiveFormatting(this.originData.processIma,2,"processIma")}),this.calcLineTableData()},recursiveFormatting(e=[],t,i=""){return e.map(l=>{if(l.text=l.name,l.expand=!1,l.level=t,t===2&&l.subList){let r=(l.subList.splice(0,1)||[{}])[0];l.dataList=r.dataList,l.text=r.name,l.info=l.name}return l.data=(l.dataList||[]).map(r=>(r.endPileStr?(r.piles=[r.startPileNo-this.startPileNo,r.endPileNo-this.startPileNo],r.end=r.piles[1],r.tooltip=`\u6869\u53F7\u8303\u56F4\uFF1A${r.startPileStr}~${r.endPileStr}`):(r.piles=[r.startPileNo-this.startPileNo],r.tooltip=`\u6869\u53F7\uFF1A${r.startPileStr}`),r.category=i,r.level=r.scoreLevel||r.level,r.start=r.piles[0],r)),l.subList&&l.subList.length&&this.recursiveFormatting(l.subList,t+1,i),l}),e},scrollHandle(e){this.translateY=-e.target.scrollTop,this.calcContentXY(),this.renderRule(),this.renderNodes()},scrollXHandle(e){this.translateX=-e.target.scrollLeft,this.calcContentXY(),this.renderRule(),this.renderNodes(),this.renderFixed()},changeMeterHandle(e){this.preMeterToPx!==e&&(this.ruleStep=this.meterToPx*this.ruleStepVal,this.renderAll())},locationHandle(){let t=this.filterData.k*1e3+this.filterData.v-this.startPileNo;this.$refs.scrollX.scrollLeft=t*this.meterToPx},calcTooltipStyle(){clearTimeout(this.timer2),this.timer2=setTimeout(()=>{if(!this.current)return{};let e=0,t=0,i=0,l=0;if(this.lineStyle={display:"none"},["rule","top"].includes(this.current.placement)){let r=this.getTextWidth(this.current.tooltip,"padding: 5px; font-size: 14px;").width/2;[l,i]=this.current.tooltipXY,this.current.placement==="rule"&&(this.lineStyle={left:l+this.position.x+"px",top:this.position.y+"px",height:this.tableHeight+"px",maxHeight:this.wrapHeight+"px"}),l=l+this.position.x-r,i+=this.position.y-30}else{[,t]=this.current.crd[0],[e]=this.current.crd[1];let r=2;t+=this.translateY,e+=0,l=this.position.x+e+r,i=this.position.y+t+10}this.tooltipStyle={left:l+"px",top:i+"px"}},10)},changeRowHeight(){this.$nextTick(()=>{this.renderAll()})}}};var ll=bt(zi,[["render",Vi],["__scopeId","data-v-42e0f136"]]);export{ll as default};
